<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realtime Voice System - Minimal Example</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status.disconnected {
            background: #fee;
            color: #c33;
        }

        .status.connected {
            background: #efe;
            color: #3c3;
        }

        .status.listening {
            background: #eef;
            color: #33c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            grid-column: span 2;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .output {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .output-section {
            margin-bottom: 15px;
        }

        .output-label {
            font-weight: 600;
            color: #667eea;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .output-content {
            color: #333;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .config-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .config-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-group label {
            min-width: 100px;
            font-size: 14px;
        }

        .config-group select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> Realtime Voice</h1>
        <div class="status disconnected" id="status">Desconectado</div>

        <div class="button-group">
            <button class="btn-primary" id="connectBtn">Conectar</button>
            <button class="btn-secondary" id="listenBtn" disabled>Escuchar</button>
            <button class="btn-secondary" id="stopBtn" disabled>Detener</button>
            <button class="btn-danger" id="disconnectBtn" disabled>Desconectar</button>
        </div>

        <div class="output" id="output">
            <div class="output-section">
                <div class="output-label">Estado</div>
                <div class="output-content" id="stateLog">Esperando conexi贸n...</div>
            </div>
        </div>

        <div class="config-section">
            <div class="config-group">
                <label for="languageSelect">Idioma:</label>
                <select id="languageSelect">
                    <option value="es">Espa帽ol</option>
                    <option value="en">English</option>
                    <option value="fr">Fran莽ais</option>
                </select>
            </div>

            <div class="config-group">
                <label for="providerSelect">Modelo LLM:</label>
                <select id="providerSelect">
                    <option value="gemini">Gemini (R谩pido)</option>
                    <option value="claude">Claude (Calidad)</option>
                    <option value="openai">OpenAI (GPT-4o-mini)</option>
                </select>
            </div>
        </div>
    </div>

    <script src="../core/client/src/realtime-voice-client.js"></script>
    <script>
        // Configuration
        const SERVER_URL = 'ws://localhost:4042'; // Change for production
        const DEBUG = true;

        // Elements
        const connectBtn = document.getElementById('connectBtn');
        const listenBtn = document.getElementById('listenBtn');
        const stopBtn = document.getElementById('stopBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const statusEl = document.getElementById('status');
        const stateLog = document.getElementById('stateLog');
        const languageSelect = document.getElementById('languageSelect');
        const providerSelect = document.getElementById('providerSelect');
        const output = document.getElementById('output');

        let client = null;

        // Log function
        function log(category, message, data = '') {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${category}: ${message}`, data);

            const section = document.createElement('div');
            section.className = 'output-section';
            section.innerHTML = `
                <div class="output-label">${category}</div>
                <div class="output-content">${message}${data ? ': ' + data : ''}</div>
            `;
            output.insertBefore(section, output.firstChild);

            // Limit log entries
            while (output.children.length > 10) {
                output.removeChild(output.lastChild);
            }
        }

        // Update status display
        function updateStatus(state) {
            let statusText = 'Desconectado';
            let statusClass = 'disconnected';

            if (state.connected) {
                statusClass = 'connected';
                statusText = state.listening ? ' Escuchando' : ' Conectado';
                if (state.listening) statusClass = 'listening';
            }

            statusEl.textContent = statusText;
            statusEl.className = `status ${statusClass}`;

            // Update buttons
            connectBtn.disabled = state.connected;
            listenBtn.disabled = !state.connected || state.listening;
            stopBtn.disabled = !state.listening;
            disconnectBtn.disabled = !state.connected;
        }

        // Connect
        connectBtn.addEventListener('click', async () => {
            try {
                connectBtn.disabled = true;
                log('CONEXIN', 'Conectando...');

                client = new RealtimeVoiceClient({
                    serverUrl: SERVER_URL,
                    language: languageSelect.value,
                    debug: DEBUG
                });

                // Setup event listeners
                client.on('ready', (data) => {
                    log('EVENTO', 'Listo para escuchar', data.clientId);
                    updateStatus(client.getState());
                });

                client.on('listening_started', () => {
                    log('EVENTO', 'Micr贸fono activado');
                    updateStatus(client.getState());
                });

                client.on('transcription', (text) => {
                    log('TRANSCRIPCIN', text);
                });

                client.on('text', (chunk) => {
                    log('RESPUESTA IA', chunk);
                });

                client.on('response_complete', () => {
                    log('EVENTO', 'Respuesta completada');
                });

                client.on('error', (error) => {
                    log('ERROR', error.message);
                });

                client.on('disconnected', () => {
                    log('EVENTO', 'Desconectado del servidor');
                    updateStatus(client.getState());
                });

                // Connect
                await client.connect();
                log('CONEXIN', 'Conectado exitosamente');
                updateStatus(client.getState());

            } catch (error) {
                log('ERROR', 'Falla en conexi贸n', error.message);
                connectBtn.disabled = false;
            }
        });

        // Start listening
        listenBtn.addEventListener('click', async () => {
            try {
                listenBtn.disabled = true;
                log('AUDIO', 'Solicitando acceso al micr贸fono...');

                await client.startListening();
                log('AUDIO', 'Micr贸fono activado');
                updateStatus(client.getState());

            } catch (error) {
                log('ERROR', 'Micr贸fono no disponible', error.message);
                listenBtn.disabled = false;
            }
        });

        // Stop listening
        stopBtn.addEventListener('click', () => {
            client.stopListening();
            log('AUDIO', 'Micr贸fono desactivado');
            updateStatus(client.getState());
        });

        // Disconnect
        disconnectBtn.addEventListener('click', () => {
            client.disconnect();
            log('CONEXIN', 'Desconectado');
            updateStatus(client.getState());
        });

        // Language change
        languageSelect.addEventListener('change', (e) => {
            if (client && client.state.connected) {
                client.setLanguage(e.target.value);
                log('CONFIGURACIN', 'Idioma cambiado', e.target.value);
            }
        });

        // Provider change
        providerSelect.addEventListener('change', (e) => {
            if (client && client.state.connected) {
                client.setLLMProvider(e.target.value);
                log('CONFIGURACIN', 'Modelo LLM cambiado', e.target.value);
            }
        });

        // Initial status
        updateStatus({ connected: false, listening: false });
        log('SISTEMA', 'Listo. Haz clic en "Conectar" para comenzar');
    </script>
</body>
</html>

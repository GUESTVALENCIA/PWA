<!DOCTYPE html>
<html lang="es" class="h-full scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GuestsValencia ¬∑ Alojamientos Inteligentes en Valencia con IA</title>
  <meta name="description" content="Descubre alojamientos premium en Valencia con llegada aut√≥noma, gesti√≥n inteligente y soporte 24/7 por nuestra IA Sandra. Tu estancia perfecta empieza aqu√≠.">
  <meta name="keywords" content="alojamientos valencia, apartamentos tur√≠sticos, alquiler vacacional valencia, sandra ia, galaxy pro, llegada aut√≥noma, smart lock">
  <link rel="canonical" href="https://guestsvalencia.es/">

  <!-- PWA -->
  <meta name="theme-color" content="#0F172A">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="GuestsValencia ¬∑ Alojamientos Inteligentes con IA">
  <meta property="og:description" content="Experimenta el futuro del alojamiento en Valencia. Llegada aut√≥noma, confort y asistencia IA 24/7.">
  <meta property="og:image" content="https://guestsvalencia.es/assets/media/og-image.jpg">
  <meta property="og:url" content="https://guestsvalencia.es/">

  <!-- Schema.org -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@graph":[{"@type":"Organization","name":"GuestsValencia","url":"https://guestsvalencia.es/","logo":"https://guestsvalencia.es/assets/media/logo-guestsvalencia-dark.svg","contactPoint":{"@type":"ContactPoint","telephone":"+34-624-020-085","contactType":"customer service"}},{"@type":"LodgingBusiness","name":"GuestsValencia","url":"https://guestsvalencia.es/","description":"Alojamientos premium con llegada aut√≥noma y asistencia IA en Valencia.","address":{"@type":"PostalAddress","addressLocality":"Valencia","addressCountry":"ES"},"telephone":"+34-624-020-085","priceRange":"‚Ç¨‚Ç¨-‚Ç¨‚Ç¨‚Ç¨"}]}
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{fontFamily:{sans:['Outfit','system-ui','sans-serif'],serif:['Playfair Display','Georgia','serif']}}}}</script>

  <style>
    :root{--primary:#2563EB;--accent:#3B82F6;--accent-light:#60A5FA;--accent-lighter:#93C5FD;--accent-dark:#1E40AF;--glass-bg:rgba(255,255,255,0.98);--glass-dark-bg:rgba(37,99,235,0.85);--text-primary:#0F172A;--text-secondary:#334155;--bg-light:#FFFFFF;--bg-section:#F8FAFC;--bg-accent:#EFF6FF}
    body{font-family:'Outfit',system-ui,sans-serif;background:var(--bg-light);color:var(--text-primary);overflow-x:hidden;margin:0;padding:0}
    html{margin:0;padding:0}
    h1,h2,h3{font-family:'Playfair Display',Georgia,serif}
    .glass{background:var(--glass-bg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.4);box-shadow:0 8px 32px rgba(0,0,0,0.1)}
    .glass-dark{background:var(--glass-dark-bg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.15);color:white;box-shadow:0 8px 32px rgba(0,0,0,0.15)}
    .hero-section{position:relative;min-height:100vh;display:flex;align-items:flex-end;justify-content:center;overflow:hidden;padding-bottom:10vh}
    .hero-video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-2}
    .hero-background-image{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center 35%;z-index:-3;transition:transform 0.3s ease}
    .hero-overlay{display:none}
    .property-card{transition:transform 0.3s,box-shadow 0.3s}.property-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.1)}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--primary));color:white;box-shadow:0 4px 15px rgba(59,130,246,0.3)}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(59,130,246,0.4);background:linear-gradient(135deg,var(--accent-light),var(--accent))}
    .page{display:none}.page.active{display:block}
    .lightbox{display:none;position:fixed;z-index:1000;inset:0;background:rgba(11,16,32,0.95);backdrop-filter:blur(8px);justify-content:center;align-items:center}
    .lightbox.show{display:flex}
    #sandra-widget-container{position:fixed;bottom:20px;right:20px;z-index:9999}
    #search-container.active{box-shadow:0 0 0 3px rgba(59,130,246,0.5),0 0 20px rgba(59,130,246,0.3),0 0 40px rgba(59,130,246,0.2)}
    #search-container.active .glass{border-color:rgba(59,130,246,0.5)}
    .ai-search-active{animation:pulse-glow 2s ease-in-out infinite}
    @keyframes pulse-glow{0%,100%{box-shadow:0 0 0 0 rgba(147,51,234,0.7),0 0 20px rgba(147,51,234,0.5)}50%{box-shadow:0 0 0 10px rgba(147,51,234,0),0 0 30px rgba(147,51,234,0.8)}}
    @keyframes fade-in{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse-slow{0%,100%{opacity:1}50%{opacity:0.7}}
    .animate-fade-in{animation:fade-in 1s ease-in-out}
    .animate-pulse-slow{animation:pulse-slow 2s ease-in-out infinite}
  </style>
</head>
<body class="font-sans text-slate-900 bg-white min-h-full flex flex-col">

  <!-- NAVBAR -->
  <nav id="main-nav" class="fixed top-0 left-0 right-0 w-full z-50 transition-all duration-300">
    <div class="w-full glass-dark px-6 py-3 flex justify-between items-center shadow-lg" style="border-radius: 0;">
      <a href="#home" class="nav-link text-2xl font-bold text-white flex items-center gap-2">
        <span class="text-blue-400">Guests</span>Valencia
      </a>
      <div class="hidden md:flex gap-6 text-sm font-medium text-slate-200">
        <a href="#home" class="nav-link hover:text-white">Inicio</a>
        <a href="#alojamientos" class="nav-link hover:text-white">Alojamientos</a>
        <a href="#servicios" class="nav-link hover:text-white">Servicios</a>
        <a href="#owners" class="nav-link hover:text-white">Propietarios</a>
        <a href="#quienes-somos" class="nav-link hover:text-white">Qui√©nes Somos</a>
        <a href="#contacto" class="nav-link hover:text-white">Contacto</a>
        <a href="https://app.guestsvalencia.es" class="nav-link hover:text-white">üì± App</a>
      </div>
      <div class="flex gap-3 items-center">
        <a href="#login" class="hidden sm:block text-slate-300 hover:text-white text-sm py-2">Acceder</a>
        <a href="#register" class="btn-primary px-4 py-2 rounded-xl text-sm font-semibold">Registrarse</a>
      </div>
    </div>
  </nav>

  <main class="flex-1">
    <!-- HOME -->
    <section id="home-page" class="page active">
      <header class="hero-section">
        <video id="hero-video" class="hero-video" autoplay muted loop playsinline style="display:none;">
          <source src="" type="video/mp4">
        </video>
        <div id="hero-background-image" class="hero-background-image" style="background-image: url('https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1920&q=95'); filter: brightness(1.05) contrast(1.1); background-size: cover; background-position: center 35%;"></div>
        <!-- Selector de carga para Hero -->
        <div class="absolute top-4 right-4 z-50">
          <label for="hero-media-upload" class="cursor-pointer bg-white/90 hover:bg-white backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg text-sm font-semibold text-blue-600 flex items-center gap-2 transition-all hover:shadow-xl">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Cambiar Hero
          </label>
          <input type="file" id="hero-media-upload" accept="image/*,video/*" class="hidden">
        </div>
        <div class="relative z-10 text-center px-6 max-w-4xl mx-auto" style="margin-top: 45vh;">
          <p class="text-lg md:text-xl text-white mb-8 max-w-2xl mx-auto font-semibold drop-shadow-2xl" style="text-shadow: 0 2px 12px rgba(0,0,0,0.4), 0 0 20px rgba(0,0,0,0.2);">Apartamentos de dise√±o con llegada aut√≥noma y asistencia 24 horas impulsadas por Sandra IA</p>
          <div id="search-container" class="glass p-2 rounded-2xl max-w-4xl mx-auto shadow-2xl transition-all duration-300">
            <form id="search-form" class="flex flex-col md:flex-row gap-2 items-center">
              <div class="flex-1 w-full md:w-auto flex gap-2">
                <input type="text" id="search-destination" placeholder="¬øA d√≥nde viajas? Ej: Ruzafa..." class="flex-1 pl-4 py-4 rounded-xl bg-white/90 text-slate-800 placeholder-slate-500 font-medium outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                <div class="relative">
                  <input type="number" id="search-guests" value="2" min="1" aria-label="N√∫mero de personas" class="w-32 px-4 py-4 rounded-xl bg-white/90 text-slate-800 font-medium outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all pr-16">
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 text-sm pointer-events-none">Personas</span>
                </div>
                <div class="relative">
                  <input type="number" id="search-nights" value="1" min="1" aria-label="N√∫mero de noches" class="w-32 px-4 py-4 rounded-xl bg-white/90 text-slate-800 font-medium outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all pr-16">
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 text-sm pointer-events-none">Noches</span>
                </div>
              </div>
              <div class="flex gap-2 w-full md:w-auto">
                <button type="button" id="btn-search-normal" class="px-6 py-4 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 shadow-lg transition-all flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                  Buscar
                </button>
                <button type="button" id="btn-search-ai" class="px-6 py-4 rounded-xl bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold hover:from-purple-700 hover:to-blue-700 shadow-lg transition-all flex items-center gap-2 relative overflow-hidden group">
                  <span class="absolute inset-0 bg-gradient-to-r from-purple-400 to-blue-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                  <svg class="w-5 h-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                  <span class="relative z-10">Buscar con IA</span>
                  <span id="ai-search-pulse" class="absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100">
                    <span class="absolute inset-0 rounded-xl bg-gradient-to-r from-purple-400/50 to-blue-400/50 animate-ping"></span>
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </header>

      <!-- VALORES PRINCIPALES -->
      <section class="py-24 px-6 bg-white">
        <div class="max-w-7xl mx-auto">
          <div class="text-center mb-16">
            <span class="text-blue-600 font-bold tracking-wider uppercase text-sm mb-2 block">Nuestros Pilares</span>
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Tecnolog√≠a, Transparencia y Experiencia Personalizada</h2>
            <p class="text-slate-600 max-w-3xl mx-auto">Descubre los factores clave de nuestra gesti√≥n de propiedades para particulares y empresas en Valencia.</p>
          </div>
          <div class="grid md:grid-cols-3 gap-8">
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mb-6">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
              </div>
              <h3 class="text-2xl font-bold text-slate-900 mb-4">Tecnolog√≠a Propia con Sandra IA</h3>
              <p class="text-slate-600 mb-4">Ofrecemos seguimiento en tiempo real de cada proceso con acceso inmediato a toda la informaci√≥n de tus propiedades.</p>
              <ul class="space-y-2 text-sm text-slate-600">
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Actualizaci√≥n de reservas y tareas en tiempo real</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Toda la informaci√≥n en una sola aplicaci√≥n</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Asistente IA 24/7 con videollamada conversacional</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Notificaciones autom√°ticas de intervenciones</li>
              </ul>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-16 h-16 bg-blue-500 rounded-2xl flex items-center justify-center mb-6">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              </div>
              <h3 class="text-2xl font-bold text-slate-900 mb-4">Transparencia Total</h3>
              <p class="text-slate-600 mb-4">Actuamos como Responsables del Tratamiento, garantizando uso l√≠cito, leal y transparente de tus datos.</p>
              <ul class="space-y-2 text-sm text-slate-600">
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Seguimiento detallado de cada proceso</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Informaci√≥n completa y accesible</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Comunicaci√≥n clara y directa</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Cumplimiento GDPR y normativas</li>
              </ul>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-16 h-16 bg-blue-400 rounded-2xl flex items-center justify-center mb-6">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
              </div>
              <h3 class="text-2xl font-bold text-slate-900 mb-4">Experiencia Personalizada</h3>
              <p class="text-slate-600 mb-4">Aseguramos una gesti√≥n eficiente que optimiza la operativa y la experiencia tanto para propietarios como hu√©spedes.</p>
              <ul class="space-y-2 text-sm text-slate-600">
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Protocolos adaptados a cada propiedad</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Disponibilidad los 365 d√≠as, festivos incluidos</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Check-in flexible y aut√≥nomo</li>
                <li class="flex items-start gap-2"><span class="text-blue-600 mt-1">‚úì</span> Atenci√≥n personalizada con Sandra IA</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- ESTAD√çSTICAS -->
      <section class="py-16 px-6 bg-blue-50/30">
        <div class="max-w-7xl mx-auto">
          <h2 class="text-2xl md:text-3xl font-bold text-slate-900 mb-8 text-center">Nuestros datos nos avalan</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center">
              <div class="text-5xl md:text-6xl font-bold text-blue-600 mb-2">+5</div>
              <div class="text-lg text-slate-600">A√±os de experiencia</div>
            </div>
            <div class="text-center">
              <div class="text-5xl md:text-6xl font-bold text-blue-600 mb-2">+50</div>
              <div class="text-lg text-slate-600">Propiedades gestionadas</div>
            </div>
            <div class="text-center">
              <div class="text-5xl md:text-6xl font-bold text-blue-600 mb-2">98%</div>
              <div class="text-lg text-slate-600">Satisfacci√≥n de hu√©spedes</div>
            </div>
          </div>
        </div>
      </section>

      <!-- FEATURED LISTINGS -->
      <section class="py-24 px-6 max-w-7xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 text-center">Alojamientos Destacados</h2>
        <p class="text-slate-600 text-center mb-12 max-w-xl mx-auto">Una selecci√≥n curada de nuestros mejores alojamientos.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="featured-grid"></div>
        <div class="mt-10 text-center">
          <a href="#alojamientos" class="nav-link inline-block btn-primary px-8 py-3 rounded-xl font-bold">Ver todos los alojamientos</a>
        </div>
      </section>

      <!-- SANDRA IA SECTION -->
      <section class="bg-white py-16 md:py-24 border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-8 md:gap-12 items-end">
          <div class="order-2 md:order-1">
            <span class="text-blue-600 font-bold tracking-wider uppercase text-sm mb-2 block">Tecnolog√≠a de Vanguardia</span>
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-6">Tu Asistente Personal de Viaje</h2>
            <p class="text-slate-600 mb-6">Nuestra asistente virtual, <strong>Sandra IA</strong>, est√° disponible 24/7 para mejorar su experiencia. Ahora con capacidad de <strong>videollamada conversacional</strong>.</p>
            <div class="bg-blue-50/40 p-6 rounded-2xl border border-blue-100/50">
              <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                <svg class="w-5 h-5 text-[#25D366]" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/></svg>
                Certificaci√≥n WhatsApp Business
              </h4>
              <p class="text-sm text-slate-600">Sandra gestiona consultas cumpliendo con Meta y GDPR. <a href="#legal" class="text-blue-600 nav-link">Leer pol√≠tica</a>.</p>
            </div>
          </div>
          <!-- ‚ö†Ô∏è LAYOUT PROTECTED: SANDRA VIDEO CALL INTERFACE - NO MODIFICAR SIN AUTORIZACI√ìN -->
          <div id="sandra-embedded-interface" class="relative w-full max-w-xs mx-auto order-1 md:order-2 flex justify-center md:justify-end items-end">
            <div class="relative bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-3xl overflow-hidden shadow-2xl flex flex-col border-2 border-blue-200/50" style="aspect-ratio: 9/16; height: 580px; max-height: calc(100vh - 150px);">
              <!-- Header de Videollamada -->
              <div class="absolute top-0 left-0 right-0 px-4 pt-3 pb-2 flex justify-between items-center z-20 bg-gradient-to-b from-blue-600/90 to-transparent backdrop-blur-md">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse shadow-lg shadow-green-400/50"></div>
                  <span class="text-white text-xs font-semibold">Videollamada</span>
                </div>
                <div class="flex items-center gap-2 bg-white/20 px-2 py-1 rounded-full backdrop-blur-sm">
                  <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg>
                  <span class="text-white text-[10px] font-medium">24/7</span>
                </div>
              </div>
              
              <!-- √Årea Principal de Video -->
              <div class="flex-1 relative bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100 flex items-center justify-center overflow-hidden">
                <!-- Avatar/Placeholder de Video -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="relative w-32 h-32 rounded-full bg-gradient-to-br from-blue-400 via-indigo-400 to-purple-400 flex items-center justify-center shadow-2xl border-4 border-white/50 overflow-hidden">
                    <!-- Selector de carga para avatar -->
                    <label for="sandra-avatar-upload" class="absolute inset-0 flex items-center justify-center cursor-pointer z-10 group">
                      <input type="file" id="sandra-avatar-upload" accept="image/*,video/*" class="hidden">
                      <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex items-center justify-center">
                        <svg class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                      </div>
                    </label>
                    <!-- Avatar fijo por defecto (foto) -->
                    <img id="sandra-avatar-image" class="absolute inset-0 w-full h-full object-cover rounded-full" src="assets/images/sandra-avatar.png" alt="Sandra Avatar" onerror="this.style.display='none'; document.getElementById('sandra-avatar-icon').style.display='block';">
                    <!-- Avatar por defecto (icono) - solo si falla la imagen -->
                    <svg id="sandra-avatar-icon" class="w-16 h-16 text-white hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    <!-- Avatar cargado (video) -->
                    <video id="sandra-avatar-video" class="absolute inset-0 w-full h-full object-cover rounded-full hidden" autoplay muted loop playsinline></video>
                  </div>
                  <!-- Ondas de audio animadas -->
                  <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div class="w-40 h-40 rounded-full border-2 border-blue-300/30 animate-ping"></div>
                    <div class="absolute w-48 h-48 rounded-full border-2 border-indigo-300/20 animate-ping" style="animation-delay: 0.5s;"></div>
                    <div class="absolute w-56 h-56 rounded-full border-2 border-purple-300/10 animate-ping" style="animation-delay: 1s;"></div>
                  </div>
                </div>
                
                <!-- Video stream (se muestra cuando hay llamada activa) -->
                <img src="/assets/images/sandra-demo.png" class="absolute inset-0 w-full h-full object-cover hidden" alt="Sandra Avatar" id="sandra-avatar-img" onerror="this.src='https://placehold.co/400x700/3b82f6/ffffff?text=Sandra+IA'">
                <video id="sandra-video-stream" class="absolute inset-0 w-full h-full object-cover hidden" playsinline></video>
                <div id="sandra-voice-pulse" class="absolute w-32 h-32 rounded-full bg-blue-500/30 blur-xl animate-pulse hidden"></div>
                
                <!-- Indicador de estado -->
                <div class="absolute top-20 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-md px-4 py-2 rounded-full shadow-lg z-10">
                  <span class="text-blue-600 text-xs font-semibold">
                    Ll√°manos
                  </span>
                </div>
              </div>
              
              <!-- Control Bar (Bottom) - Estilo Gemini -->
              <div class="absolute bottom-0 left-0 right-0 pb-4 pt-3 px-4 bg-gradient-to-t from-slate-900/95 via-slate-800/90 to-transparent backdrop-blur-lg">
                <div class="flex items-center justify-center gap-3">
                  <button id="btn-cam-toggle" class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white transition-all backdrop-blur-sm border border-white/20">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                  </button>
                  <button id="btn-mute-toggle" class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white transition-all backdrop-blur-sm border border-white/20" title="Silenciar micr√≥fono">
                    <svg id="mic-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                    <svg id="mic-muted-icon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/></svg>
                  </button>
                  <button id="btn-pause-toggle" class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white transition-all backdrop-blur-sm border border-white/20">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  </button>
                  <button id="btn-call-toggle" class="w-14 h-14 rounded-full bg-green-500 hover:bg-green-600 flex items-center justify-center text-white shadow-2xl transition-all ring-4 ring-green-500/30">
                    <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M3 21l3-3m0 0V9a6 6 0 0112 0v9m-3-3l3 3m-3-3h6m-6 0V9a3 3 0 00-3-3H9a3 3 0 00-3 3v9"/></svg>
                  </button>
                </div>
              </div>
              
              <!-- Subtitles -->
              <div id="sandra-subtitles" class="absolute bottom-20 left-0 right-0 text-center px-4 hidden z-30">
                <span class="bg-slate-900/80 backdrop-blur-md text-white px-4 py-2 rounded-xl text-sm font-medium shadow-xl border border-white/10">Espero tu respuesta...</span>
              </div>
            </div>
          </div>
        </div>
      </section>

    </section>

    <!-- ALOJAMIENTOS PAGE -->
    <section id="alojamientos-page" class="page pt-20">
      <!-- Hero Image/Video para Alojamientos -->
      <div class="relative w-full h-64 md:h-96 mb-10 overflow-hidden rounded-b-2xl">
        <video id="alojamientos-video" class="w-full h-full object-cover" autoplay muted loop playsinline style="display:none;"></video>
        <div id="alojamientos-image" class="w-full h-full bg-cover bg-center" style="background-image: url('');"></div>
        <div class="absolute top-4 right-4 z-10">
          <label for="alojamientos-media-upload" class="cursor-pointer bg-white/90 hover:bg-white backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg text-sm font-semibold text-blue-600 flex items-center gap-2 transition-all hover:shadow-xl">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Cambiar Imagen
          </label>
          <input type="file" id="alojamientos-media-upload" accept="image/*,video/*" class="hidden">
        </div>
      </div>
      <div class="mx-auto max-w-7xl px-6 py-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Todos los Alojamientos</h1>
        <p class="text-slate-600 mb-10">Explora nuestra colecci√≥n completa de propiedades.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="listings-grid"></div>
      </div>
    </section>

    <!-- SERVICIOS PAGE -->
    <section id="servicios-page" class="page pt-20">
      <!-- Hero Image/Video para Servicios -->
      <div class="relative w-full h-64 md:h-96 mb-10 overflow-hidden rounded-b-2xl">
        <video id="servicios-video" class="w-full h-full object-cover" autoplay muted loop playsinline style="display:none;"></video>
        <div id="servicios-image" class="w-full h-full bg-cover bg-center" style="background-image: url('');"></div>
        <div class="absolute top-4 right-4 z-10">
          <label for="servicios-media-upload" class="cursor-pointer bg-white/90 hover:bg-white backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg text-sm font-semibold text-blue-600 flex items-center gap-2 transition-all hover:shadow-xl">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Cambiar Imagen
          </label>
          <input type="file" id="servicios-media-upload" accept="image/*,video/*" class="hidden">
        </div>
      </div>
      <div class="mx-auto max-w-7xl px-6 py-10">
        <div class="text-center mb-12">
          <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">¬øQu√© servicios incluye la gesti√≥n de propiedades de GuestsValencia?</h1>
          <p class="text-slate-600 max-w-3xl mx-auto text-lg">Te ofrecemos una soluci√≥n integral y exclusiva para que no tengas que preocuparte por nada. Nos hacemos cargo de todos los servicios necesarios durante todas las etapas de la gesti√≥n de tu vivienda.</p>
        </div>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-600 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Creaci√≥n y Optimizaci√≥n de Anuncios</h2>
            <p class="text-slate-600 text-sm mb-4">Dise√±amos anuncios personalizados para cada alojamiento, aplicando estrategias de posicionamiento en las principales plataformas.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-500 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Estrategia de Precios Inteligente</h2>
            <p class="text-slate-600 text-sm mb-4">Aplicamos estrategias de precios analizando la demanda y el mercado para maximizar la rentabilidad de tu propiedad.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-400 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Gesti√≥n Integral de Reservas</h2>
            <p class="text-slate-600 text-sm mb-4">Gestionamos las reservas a trav√©s de tecnolog√≠a propia, asegurando una experiencia excelente en cada estancia.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-600 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Check-in / Check-out Aut√≥nomo</h2>
            <p class="text-slate-600 text-sm mb-4">Instalamos cajas de llaves inteligentes y ofrecemos soporte 24/7 para entradas y salidas flexibles.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-500 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Limpieza y Lavander√≠a Profesional</h2>
            <p class="text-slate-600 text-sm mb-4">Realizamos limpieza profesional y preparamos cada propiedad para futuras reservas con los m√°s altos est√°ndares.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-600 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Mantenimiento y Soporte T√©cnico</h2>
            <p class="text-slate-600 text-sm mb-4">Resolvemos cualquier incidencia antes, durante y despu√©s de la estancia de cada hu√©sped con equipo disponible 24/7.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-500 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Gesti√≥n de Licencias Tur√≠sticas</h2>
            <p class="text-slate-600 text-sm mb-4">Tramitamos y renovamos tu licencia tur√≠stica VT para que no te preocupes por nada. Cumplimiento normativo garantizado.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border hover:shadow-xl transition-all group">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-400 group-hover:scale-110 transition-all">
              <svg class="w-8 h-8 text-blue-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
            </div>
            <h2 class="font-bold text-xl mb-3">Asistencia IA con Sandra</h2>
            <p class="text-slate-600 text-sm mb-4">Soporte conversacional 24/7 con videollamada para consultas. Gesti√≥n inteligente de todas las consultas de hu√©spedes.</p>
            <a href="#contacto" class="text-blue-600 font-semibold text-sm flex items-center gap-1 hover:gap-2 transition-all">
              M√°s informaci√≥n <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>
        </div>
      </div>

      <!-- PLANES Y PRECIOS -->
      <section class="py-24 px-6 bg-blue-50/30">
        <div class="max-w-7xl mx-auto">
          <div class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Planes GuestsValencia para la gesti√≥n de alquileres</h2>
            <p class="text-slate-600 max-w-3xl mx-auto text-lg">Elige el plan que mejor se adapte a tus necesidades y maximiza la rentabilidad de tu propiedad en Valencia.</p>
          </div>
          <div class="grid md:grid-cols-3 gap-8 mb-12">
            <div class="bg-white rounded-2xl shadow-lg border-2 border-blue-200 overflow-hidden hover:shadow-2xl transition-all">
              <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 text-center">
                <div class="text-4xl font-bold mb-2">15%</div>
                <div class="text-lg font-semibold">POR RESERVA</div>
                <div class="text-sm mt-2 opacity-90">PLAN ESENCIAL</div>
              </div>
              <div class="p-6">
                <ul class="space-y-3 mb-6">
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Optimizaci√≥n del anuncio</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Estrategia de precios b√°sica</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Gesti√≥n de reservas</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Check-in / Check-out</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Limpieza est√°ndar</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Mantenimiento b√°sico</span>
                  </li>
                </ul>
                <a href="#contacto" class="block w-full btn-primary py-3 rounded-xl text-center font-bold">Solicitar Informaci√≥n</a>
              </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg border-2 border-blue-500 overflow-hidden hover:shadow-2xl transition-all relative">
              <div class="absolute top-4 right-4 bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold">M√ÅS POPULAR</div>
              <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 text-center">
                <div class="text-4xl font-bold mb-2">20%</div>
                <div class="text-lg font-semibold">POR RESERVA</div>
                <div class="text-sm mt-2 opacity-90">PLAN PREMIUM</div>
              </div>
              <div class="p-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                  <p class="text-sm text-blue-800 font-semibold">‚úì Todo lo del Plan Esencial +</p>
                </div>
                <ul class="space-y-3 mb-6">
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Reportes de precios avanzados</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Fotograf√≠a profesional mejorada</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">L√≠nea de atenci√≥n 24/7</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Mantenimiento ilimitado</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Gesti√≥n de licencias</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Asesoramiento legal</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Check-in flexible</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Revisi√≥n de precios mensual</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Dos limpiezas incluidas</span>
                  </li>
                </ul>
                <a href="#contacto" class="block w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl text-center font-bold hover:from-blue-600 hover:to-blue-700 transition-all">Solicitar Informaci√≥n</a>
              </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg border-2 border-blue-200 overflow-hidden hover:shadow-2xl transition-all">
              <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 text-center">
                <div class="text-2xl font-bold mb-2">IMPORTE MENSUAL</div>
                <div class="text-lg font-semibold">GARANTIZADO</div>
                <div class="text-sm mt-2 opacity-90">RENTA MENSUAL</div>
              </div>
              <div class="p-6">
                <ul class="space-y-3 mb-6">
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Ingresos fijos todos los meses</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Cobros puntuales a principio de mes</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Mayores ingresos que a largo plazo</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Despreoc√∫pate de la fluctuaci√≥n del mercado</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Mantenimientos incluidos</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Suministros incluidos</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-slate-700">Gesti√≥n de facturas simple, una factura al mes</span>
                  </li>
                </ul>
                <a href="#contacto" class="block w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-xl text-center font-bold hover:from-blue-700 hover:to-blue-800 transition-all">Solicitar Informaci√≥n</a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- BENEFICIOS -->
      <section class="py-24 px-6 bg-white">
        <div class="max-w-7xl mx-auto">
          <div class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Beneficios de gestionar tu propiedad con GuestsValencia</h2>
            <p class="text-slate-600 max-w-3xl mx-auto text-lg">Descubre todas las ventajas de confiar en nosotros para la gesti√≥n de tu alojamiento tur√≠stico en Valencia.</p>
          </div>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Mayor Rentabilidad</h3>
              <p class="text-slate-600">Maximizamos los ingresos de tu propiedad mediante estrategias de precios din√°micas y optimizaci√≥n continua de anuncios.</p>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-14 h-14 bg-blue-500 rounded-xl flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Ahorro de Tiempo</h3>
              <p class="text-slate-600">Olv√≠date de gestionar reservas, limpiezas y mantenimientos. Nos encargamos de todo para que t√∫ solo disfrutes de los ingresos.</p>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-14 h-14 bg-blue-400 rounded-xl flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Tranquilidad Total</h3>
              <p class="text-slate-600">Gesti√≥n profesional con tecnolog√≠a propia y asistencia 24/7. Tu propiedad en las mejores manos.</p>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Tecnolog√≠a Avanzada</h3>
              <p class="text-slate-600">Sistema propio con Sandra IA para seguimiento en tiempo real, check-in aut√≥nomo y gesti√≥n inteligente de reservas.</p>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-14 h-14 bg-blue-500 rounded-xl flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Experiencia Garantizada</h3>
              <p class="text-slate-600">M√°s de 5 a√±os gestionando propiedades en Valencia con un 98% de satisfacci√≥n de hu√©spedes.</p>
            </div>
            <div class="bg-gradient-to-br from-blue-50/60 to-white p-8 rounded-2xl border border-blue-100/60 hover:shadow-xl transition-all">
              <div class="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center mb-4">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Transparencia Total</h3>
              <p class="text-slate-600">Acceso completo a toda la informaci√≥n de tu propiedad: reservas, ingresos, gastos y estad√≠sticas en tiempo real.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- PROCESO -->
      <section class="py-24 px-6 bg-blue-50/30">
        <div class="max-w-7xl mx-auto">
          <div class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">C√≥mo funciona el proceso de gesti√≥n</h2>
            <p class="text-slate-600 max-w-3xl mx-auto text-lg">Un proceso simple y transparente en 4 pasos para comenzar a generar ingresos con tu propiedad.</p>
          </div>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
            <div class="text-center">
              <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-lg">1</div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Contacto Inicial</h3>
              <p class="text-slate-600">Ponte en contacto con nosotros. Analizamos tu propiedad y te ofrecemos un estudio de rentabilidad personalizado.</p>
            </div>
            <div class="text-center">
              <div class="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-lg">2</div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Firma de Contrato</h3>
              <p class="text-slate-600">Elegimos juntos el plan que mejor se adapte a tus necesidades y firmamos el acuerdo de gesti√≥n.</p>
            </div>
            <div class="text-center">
              <div class="w-20 h-20 bg-blue-400 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-lg">3</div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Preparaci√≥n y Publicaci√≥n</h3>
              <p class="text-slate-600">Realizamos fotograf√≠a profesional, optimizamos el anuncio y lo publicamos en las principales plataformas.</p>
            </div>
            <div class="text-center">
              <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-lg">4</div>
              <h3 class="text-xl font-bold text-slate-900 mb-3">Gesti√≥n Activa</h3>
              <p class="text-slate-600">Nos encargamos de todo: reservas, check-in, limpieza, mantenimiento y seguimiento continuo.</p>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- PROPIETARIOS PAGE -->
    <section id="owners-page" class="page pt-20">
      <!-- Hero Image/Video para Propietarios -->
      <div class="relative w-full h-64 md:h-96 mb-10 overflow-hidden rounded-b-2xl">
        <video id="owners-video" class="w-full h-full object-cover" autoplay muted loop playsinline style="display:none;"></video>
        <div id="owners-image" class="w-full h-full bg-cover bg-center" style="background-image: url('');"></div>
        <div class="absolute top-4 right-4 z-10">
          <label for="owners-media-upload" class="cursor-pointer bg-white/90 hover:bg-white backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg text-sm font-semibold text-blue-600 flex items-center gap-2 transition-all hover:shadow-xl">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Cambiar Imagen
          </label>
          <input type="file" id="owners-media-upload" accept="image/*,video/*" class="hidden">
        </div>
      </div>
      <div class="mx-auto max-w-7xl px-6 py-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">¬øEres propietario?</h1>
        <p class="text-lg text-slate-600 mb-8">Maximiza tus ingresos y despreoc√∫pate con nuestra gesti√≥n integral.</p>
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-8 rounded-2xl shadow-lg">
          <h2 class="text-2xl font-bold mb-4">Beneficios exclusivos para propietarios</h2>
          <ul class="space-y-2 mb-6">
            <li>‚úì Gesti√≥n 100% legal y segura</li>
            <li>‚úì Marketing y fotograf√≠a profesional</li>
            <li>‚úì Soporte t√©cnico y mantenimiento 24/7</li>
            <li>‚úì Pago mensual garantizado</li>
          </ul>
          <a href="https://wa.me/34624020085?text=Quiero%20informaci√≥n%20para%20gestionar%20mi%20vivienda" target="_blank" class="inline-block bg-white text-slate-900 px-6 py-3 rounded-lg font-bold hover:bg-gray-200 transition-colors">Contactar por WhatsApp</a>
        </div>
      </div>

      <!-- C√ÅLCULO DE RENTABILIDAD -->
      <section class="py-24 px-6 bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 text-white">
        <div class="max-w-7xl mx-auto">
          <div class="grid md:grid-cols-2 gap-12 items-center">
            <div>
              <h2 class="text-3xl md:text-4xl font-bold mb-6">Calcula la rentabilidad de tu vivienda</h2>
              <p class="text-slate-300 mb-4 text-lg">Estimamos los ingresos de tu propiedad en base a factores clave como la ubicaci√≥n, tama√±o o tipo de alojamiento en Valencia.</p>
              <p class="text-slate-300 mb-8">Desde GuestsValencia, nos pondremos en contacto contigo para conocer m√°s detalles y poder ofrecerte un estudio personalizado.</p>
              <a href="#contacto" class="inline-block bg-white text-blue-900 px-8 py-4 rounded-xl font-bold hover:bg-blue-50 transition-colors shadow-lg">Calcular rentabilidad</a>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <img src="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=600&q=80" alt="Vivienda moderna Valencia" class="rounded-2xl object-cover h-64 shadow-2xl">
              <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=600&q=80" alt="Apartamento con vistas" class="rounded-2xl object-cover h-64 shadow-2xl">
              <img src="https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?auto=format&fit=crop&w=600&q=80" alt="Interior moderno" class="rounded-2xl object-cover h-64 shadow-2xl">
              <img src="https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?auto=format&fit=crop&w=600&q=80" alt="Vista exterior" class="rounded-2xl object-cover h-64 shadow-2xl">
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- QUI√âNES SOMOS PAGE -->
    <section id="quienes-somos-page" class="page pt-20">
      <!-- Hero Image/Video para Qui√©nes Somos -->
      <div class="relative w-full h-64 md:h-96 mb-10 overflow-hidden rounded-b-2xl">
        <video id="quienes-somos-video" class="w-full h-full object-cover" autoplay muted loop playsinline style="display:none;"></video>
        <div id="quienes-somos-image" class="w-full h-full bg-cover bg-center" style="background-image: url('');"></div>
        <div class="absolute top-4 right-4 z-10">
          <label for="quienes-somos-media-upload" class="cursor-pointer bg-white/90 hover:bg-white backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg text-sm font-semibold text-blue-600 flex items-center gap-2 transition-all hover:shadow-xl">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Cambiar Imagen
          </label>
          <input type="file" id="quienes-somos-media-upload" accept="image/*,video/*" class="hidden">
        </div>
      </div>
      <div class="mx-auto max-w-5xl px-6 py-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 text-center">Qui√©nes Somos</h1>
        <p class="text-center text-slate-600 mb-10 max-w-3xl mx-auto"><strong>Valencia Dancing Club, S.L.</strong> (marca registrada <strong>Guests-Valencia</strong>) naci√≥ con un prop√≥sito claro: hacer que cada hu√©sped se sienta en casa.</p>
        <div class="grid md:grid-cols-3 gap-6 mb-8">
          <div class="bg-white p-6 rounded-2xl shadow-sm border">
            <h3 class="font-bold mb-3">Lo que hacemos</h3>
            <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
              <li>Gesti√≥n integral de alojamientos</li>
              <li>Llegada aut√≥noma y soporte 24/7</li>
              <li>Experiencia inteligente con Sandra IA</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border">
            <h3 class="font-bold mb-3">C√≥mo lo hacemos</h3>
            <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
              <li>Tecnolog√≠a + trato humano</li>
              <li>Est√°ndares medidos (OTAs)</li>
              <li>Operaci√≥n responsable</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border">
            <h3 class="font-bold mb-3">Contacto Oficial</h3>
            <ul class="text-sm text-slate-600 space-y-1">
              <li><a class="text-blue-600" href="tel:+34624020085">+34 624 020 085</a></li>
              <li><a class="text-blue-600" href="mailto:info@guestsvalencia.es">info@guestsvalencia.es</a></li>
              <li>Av. Cortes Valencianas, 58, 5¬∫</li>
            </ul>
          </div>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-sm border">
          <h3 class="font-bold mb-3">Estructura Empresarial</h3>
          <ul class="text-sm text-slate-600 space-y-1">
            <li><strong>CEO:</strong> Claytis Miguel Tom Zuaznabar</li>
            <li><strong>COO:</strong> Sandra Rodr√≠guez Fas</li>
            <li><strong>Equipo de Operaciones:</strong> Susana, Paloma y colaboradores</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- CONTACTO PAGE -->
    <section id="contacto-page" class="page pt-20">
      <div class="mx-auto max-w-7xl px-6 py-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-8">Contacto</h1>
        <div class="grid md:grid-cols-2 gap-8">
          <div class="bg-white p-8 rounded-2xl shadow-sm border">
            <h2 class="text-xl font-bold mb-4">Escr√≠benos</h2>
            <form class="space-y-4">
              <input type="text" placeholder="Nombre" class="w-full p-3 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
              <input type="email" placeholder="Email" class="w-full p-3 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
              <textarea placeholder="Mensaje" class="w-full p-3 border rounded-lg focus:ring-blue-500 focus:border-blue-500" rows="4"></textarea>
              <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-semibold">Enviar</button>
            </form>
          </div>
          <div>
            <h2 class="text-xl font-bold mb-4">Datos de contacto</h2>
            <ul class="space-y-3 text-slate-600 mb-6">
              <li>üìû <a href="tel:+34624020085" class="hover:text-blue-600">+34 624 020 085</a></li>
              <li>‚úâÔ∏è <a href="mailto:info@guestsvalencia.es" class="hover:text-blue-600">info@guestsvalencia.es</a></li>
              <li>üìç Valencia, Espa√±a</li>
            </ul>
            <iframe loading="lazy" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d197116.36841280915!2d-0.514748889988029!3d39.40794593881527!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd604f4cf0efb06f%3A0x400fa99248cac50!2sValencia!5e0!3m2!1ses!2ses!4v1665421542151!5m2!1ses!2ses" width="100%" height="300" style="border:0;border-radius:1rem" allowfullscreen="" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
        </div>
      </div>
    </section>

    <!-- LEGAL PAGE -->
    <section id="legal-page" class="page pt-20">
      <div class="mx-auto max-w-5xl px-6 py-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-8 text-center">Centro de Transparencia y Legalidad</h1>
        <div class="space-y-8">
          <div class="bg-white p-8 rounded-2xl shadow-sm border">
            <h2 class="text-2xl font-bold mb-4">Aviso Legal</h2>
            <div class="text-sm text-slate-600 space-y-2">
              <p><strong>Denominaci√≥n Social:</strong> Valencia Dancing Club, S.L.</p>
              <p><strong>Marca Registrada:</strong> Guests-Valencia (OEPM N0460930, 27/06/2024)</p>
              <p><strong>C.I.F.:</strong> B16753949</p>
              <p><strong>Domicilio:</strong> Av. Cortes Valencianas, 58, 5¬∫, 46015 Valencia</p>
              <p><strong>Email:</strong> <a href="mailto:info@guestsvalencia.es" class="text-blue-600">info@guestsvalencia.es</a></p>
              <p><strong>Tel√©fono:</strong> <a href="tel:+34624020085" class="text-blue-600">+34 624 020 085</a></p>
            </div>
          </div>
          <div class="bg-white p-8 rounded-2xl shadow-sm border">
            <h2 class="text-2xl font-bold mb-4">Pol√≠tica de Privacidad (GDPR)</h2>
            <p class="text-sm text-slate-600">En GuestsValencia, la protecci√≥n de sus datos es prioritaria. Actuamos como Responsables del Tratamiento, garantizando uso l√≠cito, leal y transparente. Sus datos se usan para gestionar reservas, cumplir obligaciones legales y, con su consentimiento, enviar comunicaciones. Puede ejercer sus derechos en info@guestsvalencia.es.</p>
          </div>
          <div class="bg-white p-8 rounded-2xl shadow-sm border">
            <h2 class="text-2xl font-bold mb-4">Pol√≠tica de WhatsApp Business</h2>
            <p class="text-sm text-slate-600">Jam√°s iniciamos conversaciones por WhatsApp. Solo respondemos cuando el usuario nos contacta primero. La comunicaci√≥n se limita a gesti√≥n de reservas. Utilizamos cuenta oficial verificada "GuestsValencia".</p>
          </div>
          <div class="bg-white p-8 rounded-2xl shadow-sm border">
            <h2 class="text-2xl font-bold mb-4">Pol√≠tica de Cookies</h2>
            <p class="text-sm text-slate-600">Utilizamos cookies esenciales para navegaci√≥n y anal√≠ticas an√≥nimas. No usamos cookies de marketing invasivas.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- AUTH PAGE -->
    <section id="auth-page" class="page pt-20">
      <div class="mx-auto max-w-md px-6 py-10">
        <div id="login-form" class="bg-white p-8 rounded-2xl shadow-md border">
          <h2 class="text-2xl font-bold text-center mb-6">Acceder</h2>
          <form class="space-y-4">
            <input type="email" placeholder="Email" class="w-full p-3 border rounded-lg">
            <input type="password" placeholder="Contrase√±a" class="w-full p-3 border rounded-lg">
            <button type="submit" class="w-full btn-primary py-3 rounded-lg font-semibold">Entrar</button>
          </form>
          <p class="mt-4 text-center text-sm"><a href="#register" class="text-blue-600 nav-link">¬øNo tienes cuenta? Reg√≠strate</a></p>
        </div>
        <div id="register-form" class="bg-white p-8 rounded-2xl shadow-md border hidden">
          <h2 class="text-2xl font-bold text-center mb-6">Registrarse</h2>
          <form class="space-y-4">
            <input type="text" placeholder="Nombre completo" class="w-full p-3 border rounded-lg">
            <input type="email" placeholder="Email" class="w-full p-3 border rounded-lg">
            <input type="password" placeholder="Contrase√±a" class="w-full p-3 border rounded-lg">
            <button type="submit" class="w-full btn-primary py-3 rounded-lg font-semibold">Crear cuenta</button>
          </form>
          <p class="mt-4 text-center text-sm"><a href="#login" class="text-blue-600 nav-link">¬øYa tienes cuenta? Accede</a></p>
        </div>
      </div>
    </section>

    <!-- ACCOMMODATION DETAIL PAGES (Generated by JS) -->
    <div id="accommodation-pages"></div>
  </main>

  <!-- FOOTER -->
  <footer class="bg-slate-900 text-white py-16">
    <div class="max-w-7xl mx-auto px-6 grid grid-cols-2 md:grid-cols-4 gap-8">
      <div class="col-span-2 md:col-span-1">
        <a href="#home" class="nav-link text-xl font-bold flex items-center gap-2 mb-4">
          <span class="text-blue-400">Guests</span>Valencia
        </a>
        <p class="text-sm text-slate-400">Marca registrada de Valencia Dancing Club, S.L.</p>
        <p class="text-xs text-slate-500 mt-2">CIF: B16753949</p>
      </div>
      <div>
        <h3 class="font-bold mb-4">Navegaci√≥n</h3>
        <ul class="space-y-2 text-sm text-slate-400">
          <li><a href="#alojamientos" class="nav-link hover:text-white">Alojamientos</a></li>
          <li><a href="#servicios" class="nav-link hover:text-white">Servicios</a></li>
          <li><a href="#owners" class="nav-link hover:text-white">Propietarios</a></li>
          <li><a href="#quienes-somos" class="nav-link hover:text-white">Qui√©nes Somos</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold mb-4">Legal</h3>
        <ul class="space-y-2 text-sm text-slate-400">
          <li><a href="#legal" class="nav-link hover:text-white">Aviso Legal</a></li>
          <li><a href="#legal" class="nav-link hover:text-white">Privacidad</a></li>
          <li><a href="#legal" class="nav-link hover:text-white">Cookies</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold mb-4">Contacto</h3>
        <ul class="space-y-2 text-sm text-slate-400">
          <li><a href="tel:+34624020085" class="hover:text-white">+34 624 020 085</a></li>
          <li><a href="mailto:info@guestsvalencia.es" class="hover:text-white">info@guestsvalencia.es</a></li>
          <li>Valencia, Espa√±a</li>
        </ul>
      </div>
    </div>
    <div class="border-t border-slate-800 mt-12 pt-8 text-center text-xs text-slate-500 max-w-7xl mx-auto px-6">
      <p>&copy; 2025 Valencia Dancing Club, S.L. Todos los derechos reservados.</p>
    </div>
  </footer>

  <!-- LIGHTBOX -->
  <div id="lightbox" class="lightbox">
    <span class="absolute top-4 right-6 text-white text-4xl cursor-pointer lightbox-close">&times;</span>
    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white text-4xl cursor-pointer lightbox-prev">&#10094;</span>
    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-white text-4xl cursor-pointer lightbox-next">&#10095;</span>
    <img src="" class="max-w-[90vw] max-h-[85vh] object-contain rounded-xl lightbox-image" alt="">
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-sm bg-black/50 px-3 py-1 rounded-full lightbox-counter"></div>
  </div>

  <!-- SANDRA WIDGET -->

  <script>
    // === ACCOMMODATIONS DATA ===
    const accommodations = [
      { id: 'atico-ciudad-artes', title: '√Åtico Premium con Vistas a Ciudad de las Artes', details: '3 hab ¬∑ hasta 6 hu√©spedes', price: 220, image: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600566753190-17f0baa2a74c?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1600&q=90'], highlights: ['Vistas panor√°micas a Ciudad de las Artes y las Ciencias', 'Terraza privada con cristales panor√°micos', 'Dise√±o moderno y luminoso'], amenities: ['Vistas exclusivas', 'Terraza privada', 'WiFi 600Mb', 'Aire acondicionado'] },
      { id: 'loft-ruzafa-moderno', title: 'Loft de Dise√±o en Ruzafa', details: '1 hab ¬∑ hasta 3 hu√©spedes', price: 130, image: 'https://images.unsplash.com/photo-1617132024938-9365f8e5a4d0?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1617132024938-9365f8e5a4d0?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1560185010-281a89c9e8b1?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=1600&q=90'], highlights: ['Dise√±o moderno y minimalista', 'Coraz√≥n de Ruzafa', 'Ideal para n√≥madas digitales'], amenities: ['Dise√±o moderno', 'Ruzafa', 'Espacio de trabajo', 'WiFi 600Mb'] },
      { id: 'apartamento-malvarrosa', title: 'Apartamento frente al Mar - Malvarrosa', details: '2 hab ¬∑ hasta 4 hu√©spedes', price: 180, image: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1600&q=90'], highlights: ['Vistas directas al mar Mediterr√°neo', 'Terraza privada con vistas', 'A 50m de la playa'], amenities: ['Vistas al mar', 'Terraza privada', 'Playa', 'WiFi 600Mb'] },
      { id: 'piso-carmen-historico', title: 'Piso Hist√≥rico en El Carmen', details: '3 hab ¬∑ hasta 6 hu√©spedes', price: 150, image: 'https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1596394516093-501ba68a0ba6?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=1600&q=90'], highlights: ['Edificio hist√≥rico siglo XVIII', 'Techos con vigas de madera', 'Coraz√≥n del Carmen'], amenities: ['Hist√≥rico', 'Encanto', 'Centro hist√≥rico', 'WiFi 600Mb'] },
      { id: 'duplex-eixample', title: 'D√∫plex Moderno en Eixample', details: '4 hab ¬∑ hasta 8 hu√©spedes', price: 195, image: 'https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600566752355-35792bedcfea?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1600&q=90'], highlights: ['Dise√±o contempor√°neo', 'Amplio espacio di√°fano', 'Zona tranquila y bien comunicada'], amenities: ['Dise√±o moderno', 'Espacioso', 'WiFi 600Mb', 'Aire acondicionado'] },
      { id: 'atico-vistas-ciudad-artes', title: '√Åtico Exclusivo - Vistas Ciudad de las Artes', details: '2 hab ¬∑ hasta 4 hu√©spedes', price: 250, image: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600566753190-17f0baa2a74c?auto=format&fit=crop&w=1600&q=90'], highlights: ['Vistas espectaculares a Ciudad de las Artes y las Ciencias', 'Terraza con cristales panor√°micos', 'Dise√±o de lujo'], amenities: ['Vistas exclusivas', 'Terraza panor√°mica', 'Lujo', 'WiFi 600Mb'] },
      { id: 'apartamento-centro', title: 'Apartamento C√©ntrico - Plaza del Ayuntamiento', details: '2 hab ¬∑ hasta 4 hu√©spedes', price: 140, image: 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600566752355-35792bedcfea?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1600&q=90'], highlights: ['Ubicaci√≥n privilegiada en el centro', 'Cerca de todos los servicios', 'Perfecto para turismo'], amenities: ['Centro', 'Bien ubicado', 'WiFi 600Mb', 'Aire acondicionado'] },
      { id: 'loft-ciudad-artes', title: 'Loft con Vistas a Ciudad de las Artes', details: '1 hab ¬∑ hasta 3 hu√©spedes', price: 160, image: 'https://images.unsplash.com/photo-1600566753190-17f0baa2a74c?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600566753190-17f0baa2a74c?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=1600&q=90'], highlights: ['Vistas a Ciudad de las Artes y las Ciencias', 'Dise√±o industrial moderno', 'Ventanas de cristal grandes'], amenities: ['Vistas exclusivas', 'Dise√±o moderno', 'WiFi 600Mb', 'Aire acondicionado'] },
      { id: 'piso-moderno-valencia', title: 'Piso Moderno con Terraza - Valencia', details: '3 hab ¬∑ hasta 6 hu√©spedes', price: 165, image: 'https://images.unsplash.com/photo-1600566752355-35792bedcfea?auto=format&fit=crop&w=1200&q=90', images: ['https://images.unsplash.com/photo-1600566752355-35792bedcfea?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1600&q=90', 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=1600&q=90'], highlights: ['Terraza privada amplia', 'Dise√±o contempor√°neo', 'Bien iluminado'], amenities: ['Terraza', 'Dise√±o moderno', 'WiFi 600Mb', 'Aire acondicionado'] }
    ];

    // === RENDER FUNCTIONS ===
    function createCard(l) {
      return `<article class="property-card bg-white rounded-3xl shadow-sm border overflow-hidden">
        <a href="#${l.id}" class="nav-link block">
          <img loading="lazy" src="${l.image}" alt="${l.title}" class="w-full h-56 object-cover">
          <div class="p-5">
            <h3 class="font-bold text-lg">${l.title}</h3>
            <div class="flex justify-between items-center mt-2">
              <span class="text-sm text-slate-600">${l.details}</span>
              <span class="font-bold text-lg text-blue-600">‚Ç¨${l.price}<span class="text-sm font-normal">/noche</span></span>
            </div>
          </div>
        </a>
      </article>`;
    }

    function createDetailPage(l) {
      return `<section id="${l.id}-page" class="page pt-20">
        <div class="max-w-7xl mx-auto px-6 py-10">
          <div class="bg-white rounded-2xl shadow-sm border overflow-hidden">
            <div class="md:flex">
              <div class="md:w-2/3 p-6">
                <h1 class="text-2xl font-bold">${l.title}</h1>
                <p class="text-slate-600 mt-1">${l.details}</p>
                <div class="mt-4 grid grid-cols-2 gap-2">
                  ${l.images.map((img, i) => `<img loading="lazy" src="${img}" alt="Vista ${i+1}" class="w-full h-40 object-cover rounded-lg cursor-pointer gallery-image" data-listing-id="${l.id}" data-index="${i}">`).join('')}
                </div>
                <div class="mt-6">
                  <h2 class="font-bold mb-2">Aspectos destacados</h2>
                  <ul class="text-slate-600 space-y-1">${l.highlights.map(h => `<li>‚Ä¢ ${h}</li>`).join('')}</ul>
                </div>
                <div class="mt-4">
                  <h2 class="font-bold mb-2">Incluye</h2>
                  <div class="flex flex-wrap gap-2">${l.amenities.map(a => `<span class="bg-blue-50 text-blue-700 text-xs px-2 py-1 rounded-full border border-blue-100">${a}</span>`).join('')}</div>
                </div>
              </div>
              <div class="md:w-1/3 bg-blue-50/40 p-6 border-l border-blue-100">
                <h2 class="text-xl font-bold">Reserva</h2>
                <p class="text-slate-600 mt-1">‚Ç¨${l.price} por noche</p>
                <form class="mt-4 space-y-3">
                  <input type="date" class="w-full rounded-lg border p-3">
                  <input type="date" class="w-full rounded-lg border p-3">
                  <select class="w-full rounded-lg border p-3"><option>1 hu√©sped</option><option selected>2 hu√©spedes</option><option>3+ hu√©spedes</option></select>
                  <button type="button" class="w-full btn-primary py-3 rounded-lg font-bold booking-btn">Reservar ahora</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>`;
    }

    // === SECTION MEDIA UPLOAD HANDLER (Gen√©rico) ===
    function initSectionMediaUpload(sectionId, uploadInputId, videoId, imageId) {
      const uploadInput = document.getElementById(uploadInputId);
      const video = document.getElementById(videoId);
      const image = document.getElementById(imageId);
      
      if (!uploadInput || !video || !image) return;
      
      // Cargar media guardado desde localStorage
      const savedMedia = localStorage.getItem(`${sectionId}Media`);
      const savedMediaType = localStorage.getItem(`${sectionId}MediaType`);
      
      if (savedMedia) {
        if (savedMediaType === 'video') {
          video.src = savedMedia;
          video.style.display = 'block';
          image.style.display = 'none';
          video.load();
        } else {
          image.style.backgroundImage = `url(${savedMedia})`;
          image.style.display = 'block';
          video.style.display = 'none';
        }
      }
      
      uploadInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        const isVideo = file.type.startsWith('video/');
        
        reader.onload = function(event) {
          const url = event.target.result;
          
          if (isVideo) {
            video.src = url;
            video.style.display = 'block';
            image.style.display = 'none';
            video.load();
            localStorage.setItem(`${sectionId}Media`, url);
            localStorage.setItem(`${sectionId}MediaType`, 'video');
          } else {
            image.style.backgroundImage = `url(${url})`;
            image.style.display = 'block';
            video.style.display = 'none';
            localStorage.setItem(`${sectionId}Media`, url);
            localStorage.setItem(`${sectionId}MediaType`, 'image');
          }
        };
        
        reader.readAsDataURL(file);
      });
    }

    // === HERO MEDIA UPLOAD HANDLER ===
    function initHeroMediaUpload() {
      const uploadInput = document.getElementById('hero-media-upload');
      const heroVideo = document.getElementById('hero-video');
      const heroBackgroundImage = document.getElementById('hero-background-image');
      
      // Cargar media guardado desde localStorage
      const savedMedia = localStorage.getItem('heroMedia');
      const savedMediaType = localStorage.getItem('heroMediaType');
      
      if (savedMedia) {
        if (savedMediaType === 'video') {
          heroVideo.querySelector('source').src = savedMedia;
          heroVideo.style.display = 'block';
          heroBackgroundImage.style.display = 'none';
          heroVideo.load();
        } else {
          heroBackgroundImage.style.backgroundImage = `url(${savedMedia})`;
          heroBackgroundImage.style.backgroundSize = 'cover';
          heroBackgroundImage.style.backgroundPosition = 'center 35%';
          heroVideo.style.display = 'none';
          heroBackgroundImage.style.display = 'block';
        }
      }
      
      uploadInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        const isVideo = file.type.startsWith('video/');
        
        reader.onload = function(event) {
          const url = event.target.result;
          
          if (isVideo) {
            heroVideo.querySelector('source').src = url;
            heroVideo.style.display = 'block';
            heroBackgroundImage.style.display = 'none';
            heroVideo.load();
            localStorage.setItem('heroMedia', url);
            localStorage.setItem('heroMediaType', 'video');
          } else {
            heroBackgroundImage.style.backgroundImage = `url(${url})`;
            heroBackgroundImage.style.filter = 'brightness(1.05) contrast(1.1)';
            heroBackgroundImage.style.backgroundSize = 'cover';
            heroBackgroundImage.style.backgroundPosition = 'center 35%';
            heroVideo.style.display = 'none';
            heroBackgroundImage.style.display = 'block';
            localStorage.setItem('heroMedia', url);
            localStorage.setItem('heroMediaType', 'image');
          }
        };
        
        reader.readAsDataURL(file);
      });
    }

    // === INIT ===
    document.addEventListener('DOMContentLoaded', function() {
      initHeroMediaUpload();
      initSandraAvatarUpload();
      
      // Inicializar selectores de carga para cada secci√≥n
      initSectionMediaUpload('alojamientos', 'alojamientos-media-upload', 'alojamientos-video', 'alojamientos-image');
      initSectionMediaUpload('servicios', 'servicios-media-upload', 'servicios-video', 'servicios-image');
      initSectionMediaUpload('owners', 'owners-media-upload', 'owners-video', 'owners-image');
      initSectionMediaUpload('quienes-somos', 'quienes-somos-media-upload', 'quienes-somos-video', 'quienes-somos-image');
      const featuredGrid = document.getElementById('featured-grid');
      const listingsGrid = document.getElementById('listings-grid');
      const detailContainer = document.getElementById('accommodation-pages');

      accommodations.forEach((l, i) => {
        const card = createCard(l);
        if (i < 6) featuredGrid.innerHTML += card;
        listingsGrid.innerHTML += card;
        detailContainer.innerHTML += createDetailPage(l);
      });

      // Navigation
      function navigate() {
        let hash = location.hash.slice(1) || 'home';
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

        if (hash === 'login' || hash === 'register') {
          document.getElementById('auth-page').classList.add('active');
          document.getElementById('login-form').classList.toggle('hidden', hash !== 'login');
          document.getElementById('register-form').classList.toggle('hidden', hash !== 'register');
        } else {
          const page = document.getElementById(hash + '-page');
          if (page) page.classList.add('active');
          else document.getElementById('home-page').classList.add('active');
        }
        window.scrollTo(0, 0);
      }

      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          const target = new URL(link.href).hash;
          if (location.hash !== target) location.hash = target;
          else navigate();
        });
      });

      window.addEventListener('hashchange', navigate);
      navigate();

      // === SANDRA AVATAR UPLOAD HANDLER ===
      function initSandraAvatarUpload() {
        const uploadInput = document.getElementById('sandra-avatar-upload');
        const avatarIcon = document.getElementById('sandra-avatar-icon');
        const avatarImage = document.getElementById('sandra-avatar-image');
        const avatarVideo = document.getElementById('sandra-avatar-video');
        
        if (!uploadInput || !avatarIcon || !avatarImage || !avatarVideo) {
          console.log('Elementos del avatar no encontrados, reintentando...');
          setTimeout(initSandraAvatarUpload, 100);
          return;
        }
        
        // Cargar avatar guardado desde localStorage al iniciar
        function loadSavedAvatar() {
          const savedAvatar = localStorage.getItem('sandraAvatar');
          const savedAvatarType = localStorage.getItem('sandraAvatarType');
          
          if (savedAvatar && savedAvatar.trim() !== '' && savedAvatar !== 'null') {
            if (savedAvatarType === 'video') {
              avatarVideo.src = savedAvatar;
              avatarVideo.classList.remove('hidden');
              avatarIcon.classList.add('hidden');
              avatarImage.classList.add('hidden');
              avatarVideo.load();
              avatarVideo.play().catch(e => console.log('Error al reproducir video:', e));
            } else if (savedAvatarType === 'image') {
              avatarImage.src = savedAvatar;
              avatarImage.classList.remove('hidden');
              avatarIcon.classList.add('hidden');
              avatarVideo.classList.add('hidden');
            }
          } else {
            // Si no hay avatar guardado, mostrar la imagen por defecto
            avatarImage.classList.remove('hidden');
            avatarIcon.classList.add('hidden');
            avatarVideo.classList.add('hidden');
          }
        }
        
        // Cargar al iniciar
        loadSavedAvatar();
        
        uploadInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          const isVideo = file.type.startsWith('video/');
          
          reader.onload = function(event) {
            const url = event.target.result;
            
            // Guardar en localStorage
            localStorage.setItem('sandraAvatar', url);
            localStorage.setItem('sandraAvatarType', isVideo ? 'video' : 'image');
            
            if (isVideo) {
              avatarVideo.src = url;
              avatarVideo.classList.remove('hidden');
              avatarIcon.classList.add('hidden');
              avatarImage.classList.add('hidden');
              avatarVideo.load();
              avatarVideo.play().catch(e => console.log('Error al reproducir video:', e));
            } else {
              avatarImage.src = url;
              avatarImage.classList.remove('hidden');
              avatarIcon.classList.add('hidden');
              avatarVideo.classList.add('hidden');
            }
          };
          
          reader.onerror = function() {
            console.error('Error al leer el archivo');
          };
          
          reader.readAsDataURL(file);
        });
      }

      // === SANDRA VIDEO CALL CONTROLS ===
      let isMuted = false;
      const btnMuteToggle = document.getElementById('btn-mute-toggle');
      const micIcon = document.getElementById('mic-icon');
      const micMutedIcon = document.getElementById('mic-muted-icon');
      
      if (btnMuteToggle) {
        btnMuteToggle.addEventListener('click', function() {
          isMuted = !isMuted;
          if (isMuted) {
            micIcon.classList.add('hidden');
            micMutedIcon.classList.remove('hidden');
            btnMuteToggle.classList.add('bg-red-500/50');
            // Aqu√≠ se implementar√≠a la l√≥gica para silenciar el micr√≥fono
            console.log('Micr√≥fono silenciado');
          } else {
            micIcon.classList.remove('hidden');
            micMutedIcon.classList.add('hidden');
            btnMuteToggle.classList.remove('bg-red-500/50');
            // Aqu√≠ se implementar√≠a la l√≥gica para activar el micr√≥fono
            console.log('Micr√≥fono activado');
          }
        });
      }

      // === SEARCH FUNCTIONALITY ===
      const searchContainer = document.getElementById('search-container');
      const searchForm = document.getElementById('search-form');
      const searchDestination = document.getElementById('search-destination');
      const searchGuests = document.getElementById('search-guests');
      const searchNights = document.getElementById('search-nights');
      const btnSearchNormal = document.getElementById('btn-search-normal');
      const btnSearchAI = document.getElementById('btn-search-ai');

      // Focus effect on search container
      [searchDestination, searchGuests, searchNights].forEach(input => {
        input.addEventListener('focus', () => {
          searchContainer.classList.add('active');
        });
        input.addEventListener('blur', () => {
          setTimeout(() => {
            if (!searchDestination.matches(':focus') && !searchGuests.matches(':focus') && !searchNights.matches(':focus')) {
              searchContainer.classList.remove('active');
            }
          }, 100);
        });
      });

      // Normal search - navigate to accommodations page
      btnSearchNormal.addEventListener('click', (e) => {
        e.preventDefault();
        location.hash = 'alojamientos';
        navigate();
      });

      // AI Search - connect with Sandra
      btnSearchAI.addEventListener('click', async (e) => {
        e.preventDefault();
        const destination = searchDestination.value.trim();
        const guests = searchGuests.value || 2;
        const nights = searchNights.value || 1;

        // Add active state to button
        btnSearchAI.classList.add('ai-search-active');
        searchContainer.classList.add('active');

        // Simulate Sandra processing (this will be replaced with actual Sandra integration)
        await handleAISearch(destination, guests, nights);

        // Remove active state after processing
        setTimeout(() => {
          btnSearchAI.classList.remove('ai-search-active');
          searchContainer.classList.remove('active');
        }, 2000);
      });

      // AI Search Handler - connects with Sandra
      async function handleAISearch(destination, guests, nights) {
        // Show loading state
        const subtitles = document.getElementById('sandra-subtitles');
        if (subtitles) {
          subtitles.classList.remove('hidden');
          subtitles.querySelector('span').textContent = 'Procesando tu b√∫squeda...';
        }

        // Simulate Sandra processing
        // In production, this will connect to actual Sandra API
        const searchQuery = {
          destination: destination || 'Valencia',
          guests: parseInt(guests),
          nights: parseInt(nights)
        };

        // Simulate Sandra response
        setTimeout(() => {
          if (subtitles) {
            subtitles.querySelector('span').textContent = `Perfecto, encontr√© alojamientos para ${guests} personas por ${nights} noche${nights > 1 ? 's' : ''} en ${destination || 'Valencia'}. Te muestro las opciones...`;
          }

          // Navigate to accommodations page after Sandra confirms
          setTimeout(() => {
            location.hash = 'alojamientos';
            navigate();
            
            // Filter accommodations if destination is specified
            if (destination) {
              filterAccommodationsByDestination(destination);
            }

            if (subtitles) {
              setTimeout(() => {
                subtitles.querySelector('span').textContent = 'Aqu√≠ tienes los alojamientos disponibles. ¬øCu√°l te interesa?';
              }, 1000);
            }
          }, 2000);
        }, 1500);
      }

      // Function to navigate to specific accommodation when Sandra says so
      window.navigateToAccommodation = function(accommodationName) {
        const nameLower = accommodationName.toLowerCase();
        const found = accommodations.find(acc => {
          const titleLower = acc.title.toLowerCase();
          return titleLower.includes(nameLower) || nameLower.includes(titleLower.split(' ')[0]);
        });

        if (found) {
          location.hash = found.id;
          navigate();
          const subtitles = document.getElementById('sandra-subtitles');
          if (subtitles) {
            subtitles.querySelector('span').textContent = `Perfecto, aqu√≠ est√° ${found.title}. ¬øTe gustar√≠a reservarlo?`;
          }
        } else {
          // If not found, show all accommodations
          location.hash = 'alojamientos';
          navigate();
        }
      };

      // Listen for Sandra messages (this will be connected to actual Sandra widget)
      window.addEventListener('sandra-message', (e) => {
        const message = e.detail.message.toLowerCase();
        
        // Check if Sandra wants to navigate to a specific accommodation
        const accommodationKeywords = ['caba√±a', 'cabana', 'loft', '√°tico', 'atico', 'villa', 'chalet', 'piso', 'apartamento', 'duplex'];
        for (const keyword of accommodationKeywords) {
          if (message.includes(keyword)) {
            window.navigateToAccommodation(keyword);
            break;
          }
        }

        // Check if Sandra says to go to accommodations page
        if (message.includes('alojamientos') || message.includes('opciones') || message.includes('disponibles')) {
          location.hash = 'alojamientos';
          navigate();
        }
      });

      // Filter accommodations by destination (helper function)
      function filterAccommodationsByDestination(destination) {
        const destinationLower = destination.toLowerCase();
        const filtered = accommodations.filter(acc => {
          const titleLower = acc.title.toLowerCase();
          const detailsLower = acc.details.toLowerCase();
          return titleLower.includes(destinationLower) || detailsLower.includes(destinationLower);
        });

        // Update listings grid if on accommodations page
        const listingsGrid = document.getElementById('listings-grid');
        if (listingsGrid && location.hash === '#alojamientos') {
          listingsGrid.innerHTML = '';
          filtered.forEach(l => {
            listingsGrid.innerHTML += createCard(l);
          });
        }
      }

      // Lightbox
      const lightbox = document.getElementById('lightbox');
      const lbImg = lightbox.querySelector('.lightbox-image');
      const lbCounter = lightbox.querySelector('.lightbox-counter');
      let currentImages = [], currentIdx = 0;

      document.body.addEventListener('click', e => {
        if (e.target.classList.contains('gallery-image')) {
          const lid = e.target.dataset.listingId;
          const listing = accommodations.find(a => a.id === lid);
          if (listing) {
            currentImages = listing.images;
            currentIdx = parseInt(e.target.dataset.index);
            showImage();
            lightbox.classList.add('show');
          }
        }
        if (e.target.classList.contains('lightbox-close')) lightbox.classList.remove('show');
        if (e.target.classList.contains('lightbox-prev')) { currentIdx = (currentIdx - 1 + currentImages.length) % currentImages.length; showImage(); }
        if (e.target.classList.contains('lightbox-next')) { currentIdx = (currentIdx + 1) % currentImages.length; showImage(); }
        if (e.target.classList.contains('booking-btn')) alert('‚úì ¬°Reserva confirmada! Recibir√°s un email con los detalles.');
      });

      function showImage() {
        lbImg.src = currentImages[currentIdx];
        lbCounter.textContent = `${currentIdx + 1} / ${currentImages.length}`;
      }

      document.addEventListener('keydown', e => {
        if (!lightbox.classList.contains('show')) return;
        if (e.key === 'Escape') lightbox.classList.remove('show');
        if (e.key === 'ArrowRight') { currentIdx = (currentIdx + 1) % currentImages.length; showImage(); }
        if (e.key === 'ArrowLeft') { currentIdx = (currentIdx - 1 + currentImages.length) % currentImages.length; showImage(); }
      });

      // Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js').catch(() => {});
      }
    });
  </script>

  <!-- Sistema Galaxy - Widget Flotante -->
  <script>
    // Sandra Gateway Client
    class SandraGateway {
      constructor() {
        // Dynamic base URL detection (local vs production)
        if (window.location.hostname === 'localhost' || window.location.port === '4040') {
          this.baseUrl = '/api';
        } else if (window.location.protocol === 'file:') {
          // Si se abre desde file://, usar localhost
          this.baseUrl = 'http://localhost:4040/api';
        } else {
          this.baseUrl = '/api';
        }
      }

      async sendMessage(message, role = 'hospitality') {
        try {
          const response = await fetch(`${this.baseUrl}/sandra/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, role })
          });

          if (!response.ok) throw new Error('Gateway Error');
          const data = await response.json();
          return data.reply;
        } catch (error) {
          console.error('Conversation Error:', error);
          throw error;
        }
      }
    }

    // Sandra Widget
    class SandraWidget {
      constructor() {
        this.gateway = new SandraGateway();
        this.isOpen = false;
        this.isRecording = false;
        this.isCallPaused = false;
        this.isMicrophoneMuted = false;
        this.isSpeaking = false;
        this.audioQueue = [];
        this.currentAudio = null;
      this.activeCall = null;
      this.chatLocked = false; // bloquea chat durante llamada de voz
      this.ringtoneInterval = null;
      this.lastNoSpeechTime = null;
        this.init();
      }

      init() {
        this.createWidgetUI();
        this.bindEvents();
      }

      createWidgetUI() {
        const widgetHTML = `
          <div id="sandra-widget-root" class="fixed bottom-4 right-4 z-50 font-sans">
            <button id="sandra-toggle-btn" class="w-14 h-14 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-xl hover:scale-105 transition-transform flex items-center justify-center group overflow-hidden border-2 border-white/20">
              <span class="text-2xl group-hover:hidden">üí¨</span>
              <img src="assets/images/sandra-avatar.png" onerror="this.style.display='none'" class="hidden group-hover:block w-full h-full object-cover rounded-full">
              <span class="absolute top-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
            </button>

            <div id="sandra-chat-window" class="hidden absolute bottom-16 right-0 w-[320px] h-[450px] bg-white rounded-xl shadow-2xl flex flex-col overflow-hidden border border-slate-200 transform origin-bottom-right transition-all duration-300 scale-95 opacity-0">
              <div class="p-3 bg-gradient-to-r from-[#0F172A] to-[#1E293B] text-white flex justify-between items-center">
                <div class="flex items-center gap-2 flex-1">
                  <div class="relative">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 flex items-center justify-center text-sm font-bold">S</div>
                    <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-400 border-2 border-[#0F172A] rounded-full animate-pulse"></div>
                  </div>
                  <div>
                    <h3 class="font-bold text-xs">Sandra IA</h3>
                    <p class="text-[10px] text-blue-200">Asistente Virtual 24/7</p>
                  </div>
                </div>
                <button id="sandra-close-btn" class="text-white/60 hover:text-white transition-colors text-lg leading-none">‚úï</button>
              </div>


              <div id="sandra-messages" class="flex-1 overflow-y-auto p-3 space-y-3 bg-slate-50 scroll-smooth">
                <div class="flex gap-2">
                  <div class="w-6 h-6 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 flex-shrink-0 flex items-center justify-center text-[10px] text-white font-bold">S</div>
                  <div class="bg-white p-2.5 rounded-xl rounded-tl-none shadow-sm border border-slate-100 text-xs text-slate-700 max-w-[85%]">
                    <p>¬°Hola! Soy Sandra. Bienvenido a GuestsValencia. ¬øEn qu√© puedo ayudarte hoy?</p>
                  </div>
                </div>
                <!-- Bot√≥n de llamada conversacional (se muestra despu√©s del primer mensaje) -->
                <div id="sandra-call-prompt" class="flex gap-2 mt-2">
                  <div class="w-6 h-6 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 flex-shrink-0 flex items-center justify-center text-[10px] text-white font-bold">S</div>
                  <div class="bg-white p-2.5 rounded-xl rounded-tl-none shadow-sm border border-slate-100 text-xs text-slate-700 max-w-[85%]">
                    <p class="mb-2">¬øPrefieres una llamada de voz conversacional para entendernos mejor?</p>
                    <div class="flex gap-2 mt-2">
                      <button id="sandra-accept-call" class="px-3 py-1.5 bg-green-600 text-white text-[10px] rounded-lg hover:bg-green-700 transition-colors font-semibold">
                        ‚úì Aceptar llamada
                      </button>
                      <button id="sandra-decline-call" class="px-3 py-1.5 bg-slate-200 text-slate-700 text-[10px] rounded-lg hover:bg-slate-300 transition-colors">
                        Continuar por chat
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div id="sandra-typing" class="hidden px-3 py-1.5 text-[10px] text-slate-400 italic">
                Sandra est√° escribiendo...
              </div>

              <div class="p-3 bg-white border-t border-slate-100">
                <!-- Barrita flotante de control de llamada (solo visible durante llamada) -->
                <div id="sandra-call-controls" class="hidden mb-2 flex justify-center items-center gap-2 bg-slate-50 rounded-full px-3 py-2 shadow-sm border border-slate-200">
                  <!-- Bot√≥n Colgar (rojo) -->
                  <button id="sandra-hangup-btn" class="p-2 rounded-full bg-red-600 text-white hover:bg-red-700 transition-colors shadow-sm" title="Colgar llamada">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12a9 9 0 1018 0 9 9 0 00-18 0z" /></svg>
                  </button>
                  <!-- Bot√≥n Pausar -->
                  <button id="sandra-pause-btn" class="p-2 rounded-full bg-yellow-500 text-white hover:bg-yellow-600 transition-colors shadow-sm" title="Pausar llamada">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  </button>
                  <!-- Bot√≥n Silenciar micr√≥fono -->
                  <button id="sandra-mute-btn" class="p-2 rounded-full bg-slate-400 text-white hover:bg-slate-500 transition-colors shadow-sm" title="Silenciar micr√≥fono">
                    <svg id="sandra-mute-icon" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                    <svg id="sandra-unmute-icon" class="w-4 h-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" /></svg>
                  </button>
                </div>
                <div class="relative flex items-center gap-1.5">
                  <input type="text" id="sandra-input" placeholder="Escribe tu mensaje..." class="flex-1 bg-slate-100 border-0 rounded-full px-3 py-2 text-xs focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                  <button id="sandra-mic-btn" class="p-2 rounded-full bg-slate-100 text-slate-600 hover:bg-blue-100 hover:text-blue-600 transition-colors">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                  </button>
                  <button id="sandra-send-btn" class="p-2 rounded-full bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-blue-500/30 transition-all">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                  </button>
                </div>
                <div class="text-[9px] text-center text-slate-400 mt-1">
                  Powered by Gemini & GPT-4o
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', widgetHTML);
      }

      bindEvents() {
        const toggleBtn = document.getElementById('sandra-toggle-btn');
        const closeBtn = document.getElementById('sandra-close-btn');
        const chatWindow = document.getElementById('sandra-chat-window');
        const sendBtn = document.getElementById('sandra-send-btn');
        const input = document.getElementById('sandra-input');

        const toggleChat = () => {
          this.isOpen = !this.isOpen;
          if (this.isOpen) {
            chatWindow.classList.remove('hidden');
            setTimeout(() => {
              chatWindow.classList.remove('scale-95', 'opacity-0');
              chatWindow.classList.add('scale-100', 'opacity-100');
              input.focus();
            }, 10);
          } else {
            chatWindow.classList.remove('scale-100', 'opacity-100');
            chatWindow.classList.add('scale-95', 'opacity-0');
            setTimeout(() => chatWindow.classList.add('hidden'), 300);
          }
        };

        toggleBtn.addEventListener('click', toggleChat);
        closeBtn.addEventListener('click', toggleChat);

        const sendMessage = async () => {
          // VERIFICACI√ìN DE SEGURIDAD: Resetear chatLocked si no hay llamada activa
          if (!this.activeCall && this.chatLocked) {
            console.log('üîß Reseteando chatLocked: no hay llamada activa pero el flag estaba bloqueado');
            this.chatLocked = false;
          }
          
          // BLOQUEAR CHAT DURANTE LLAMADA CONVERSACIONAL
          if (this.activeCall || this.chatLocked) {
            console.log('‚ö†Ô∏è Chat bloqueado: hay una llamada conversacional activa');
            this.addMessage('Est√°s en una llamada conversacional. Por favor, habla directamente o cuelga la llamada para usar el chat.', 'bot');
            return;
          }
          
          const text = input.value.trim();
          if (!text) return;

          this.addMessage(text, 'user');
          input.value = '';
          this.showTyping(true);

          try {
            // Siempre usar rol "luxury" (Concierge) sin mostrarlo
            const response = await this.gateway.sendMessage(text, 'luxury');
            this.showTyping(false);
            this.addMessage(response, 'bot');
            
            // Detectar si el usuario solicita llamada de voz conversacional
            const lowerText = text.toLowerCase();
            const callKeywords = ['llamada de voz', 'llamada conversacional', 'hablar contigo', 'llamar', 'llamada', 'hablar', 'conversaci√≥n de voz', 'audio', 'voz'];
            // Excluir palabras que puedan confundir con videollamada
            const excludeKeywords = ['videollamada', 'video llamada', 'videocall', 'video'];
            const wantsCall = callKeywords.some(keyword => lowerText.includes(keyword)) && 
                            !excludeKeywords.some(keyword => lowerText.includes(keyword));
            
            if (wantsCall) {
              // Mostrar mensaje autom√°tico de Sandra y el bot√≥n de llamada de voz
              setTimeout(() => {
                this.addMessage('¬°Por supuesto! Te ofrezco una llamada de voz conversacional en tiempo real para que podamos entendernos mejor. ¬øQuieres iniciarla?', 'bot');
                setTimeout(() => {
                  this.showCallPrompt();
                }, 500);
              }, 800);
            }
          } catch (error) {
            this.showTyping(false);
            this.addMessage("Lo siento, tuve un problema de conexi√≥n. Int√©ntalo de nuevo.", 'bot');
          }
        };

        sendBtn.addEventListener('click', sendMessage);
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendMessage();
        });

        // === BOT√ìN DE MICR√ìFONO (DICTADO) ===
        const micBtn = document.getElementById('sandra-mic-btn');
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingStream = null;
        let recordingStartTime = null;
        const MAX_RECORDING_TIME = 20 * 60 * 1000; // 20 minutos
        const CHUNK_DURATION = 30 * 1000; // 30 segundos
        
        if (micBtn) {
          // VERIFICACI√ìN DE SEGURIDAD: Asegurar que el bot√≥n est√© habilitado si no hay llamada activa
          if (!this.activeCall) {
            micBtn.disabled = false;
            micBtn.style.opacity = '1';
          }
          
          micBtn.addEventListener('click', async () => {
            // VERIFICACI√ìN DE SEGURIDAD: Resetear estado si no hay llamada activa
            if (!this.activeCall && (micBtn.disabled || micBtn.style.opacity === '0.5')) {
              micBtn.disabled = false;
              micBtn.style.opacity = '1';
            }
            
            if (!isRecording) {
              // Iniciar grabaci√≥n
              try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                recordingStream = stream;
                recordingStartTime = Date.now();
                
                mediaRecorder = new MediaRecorder(stream, {
                  mimeType: 'audio/webm;codecs=opus'
                });
                
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                  if (event.data.size > 0) {
                    audioChunks.push(event.data);
                  }
                };
                
                mediaRecorder.onstop = async () => {
                  // Procesar chunk de 30 segundos
                  if (audioChunks.length > 0) {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    audioChunks = [];
                    
                    // Convertir a base64 y transcribir
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                      const base64Audio = reader.result.split(',')[1];
                      
                      // Mostrar indicador de transcripci√≥n
                      this.showTyping(true);
                      this.addMessage('üé§ Transcribiendo...', 'user');
                      
                      try {
                        // Llamar a la API para transcribir con Deepgram
                        const response = await fetch('http://localhost:4040/api/sandra/transcribe', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ audio: base64Audio })
                        });
                        
                        const data = await response.json();
                        
                        if (data.transcript && data.transcript.trim()) {
                          // Eliminar el mensaje de "Transcribiendo..."
                          const messagesContainer = document.getElementById('sandra-messages');
                          const lastMessage = messagesContainer.lastElementChild;
                          if (lastMessage && lastMessage.textContent.includes('Transcribiendo')) {
                            lastMessage.remove();
                          }
                          
                          // Agregar texto transcrito al input y enviar
                          input.value = data.transcript;
                          sendMessage();
                        } else {
                          this.showTyping(false);
                          this.addMessage('No se pudo transcribir el audio. Intenta de nuevo.', 'bot');
                        }
                      } catch (error) {
                        console.error('Error transcribiendo:', error);
                        this.showTyping(false);
                        this.addMessage('Error al transcribir. Intenta de nuevo.', 'bot');
                      }
                    };
                    reader.readAsDataURL(audioBlob);
                  }
                  
                  // Si a√∫n estamos grabando y no hemos alcanzado el l√≠mite, continuar
                  const elapsed = Date.now() - recordingStartTime;
                  if (isRecording && elapsed < MAX_RECORDING_TIME) {
                    setTimeout(() => {
                      if (isRecording && mediaRecorder && mediaRecorder.state === 'inactive') {
                        mediaRecorder.start(CHUNK_DURATION);
                      }
                    }, 500);
                  }
                };
                
                // Iniciar grabaci√≥n con chunks de 30 segundos
                mediaRecorder.start(CHUNK_DURATION);
                isRecording = true;
                
                // Actualizar UI
                micBtn.classList.add('bg-red-500', 'text-white');
                micBtn.classList.remove('bg-slate-100', 'text-slate-600');
                micBtn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>';
                
                this.addMessage('üé§ Grabando... (m√°ximo 20 minutos)', 'bot');
                
              } catch (error) {
                console.error('Error accediendo al micr√≥fono:', error);
                this.addMessage('No se pudo acceder al micr√≥fono. Por favor, permite el acceso.', 'bot');
              }
            } else {
              // Detener grabaci√≥n
              isRecording = false;
              if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
              }
              if (recordingStream) {
                recordingStream.getTracks().forEach(track => track.stop());
                recordingStream = null;
              }
              
              // Actualizar UI
              micBtn.classList.remove('bg-red-500', 'text-white');
              micBtn.classList.add('bg-slate-100', 'text-slate-600');
              micBtn.innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>';
              
              this.addMessage('‚èπÔ∏è Grabaci√≥n detenida', 'bot');
            }
          });
        }

        // === LLAMADA CONVERSACIONAL ===
        const acceptCallBtn = document.getElementById('sandra-accept-call');
        const declineCallBtn = document.getElementById('sandra-decline-call');
        const callPrompt = document.getElementById('sandra-call-prompt');

        if (acceptCallBtn) {
          acceptCallBtn.addEventListener('click', () => {
            this.startConversationalCall();
            if (callPrompt) callPrompt.style.display = 'none';
            // Mostrar barrita de control
            const callControls = document.getElementById('sandra-call-controls');
            if (callControls) callControls.classList.remove('hidden');
          });
        }

        if (declineCallBtn) {
          declineCallBtn.addEventListener('click', () => {
            if (callPrompt) callPrompt.style.display = 'none';
            this.stopRingtone();
          });
        }

        // === BARRA DE CONTROL DE LLAMADA ===
        const hangupBtn = document.getElementById('sandra-hangup-btn');
        const pauseBtn = document.getElementById('sandra-pause-btn');
        const muteBtn = document.getElementById('sandra-mute-btn');
        const callControls = document.getElementById('sandra-call-controls');
        
        if (hangupBtn) {
          hangupBtn.addEventListener('click', () => {
            this.endConversationalCall();
            if (callControls) callControls.classList.add('hidden');
          });
        }
        
        // Bot√≥n Pausar
        if (pauseBtn) {
          pauseBtn.addEventListener('click', () => {
            this.toggleCallPause();
          });
        }
        
        // Bot√≥n Silenciar micr√≥fono
        if (muteBtn) {
          muteBtn.addEventListener('click', () => {
            this.toggleMicrophoneMute();
          });
        }

        // === L√ìGICA DE LIMPIEZA DE CHAT (48 horas) ===
        this.initChatCleanup();
      }

      initChatCleanup() {
        const CHAT_EXPIRY_HOURS = 48; // 48 horas
        const lastCleanup = localStorage.getItem('sandra-chat-last-cleanup');
        const now = Date.now();
        
        // Si no hay registro o han pasado m√°s de 48 horas, limpiar chat
        if (!lastCleanup || (now - parseInt(lastCleanup)) > (CHAT_EXPIRY_HOURS * 60 * 60 * 1000)) {
          this.clearChatHistory();
          localStorage.setItem('sandra-chat-last-cleanup', now.toString());
        }
      }

      clearChatHistory() {
        const messagesContainer = document.getElementById('sandra-messages');
        if (messagesContainer) {
          // Mantener solo el mensaje inicial de bienvenida
          const welcomeMessage = messagesContainer.querySelector('.flex.gap-2:first-child');
          messagesContainer.innerHTML = '';
          if (welcomeMessage) {
            messagesContainer.appendChild(welcomeMessage);
          }
        }
      }

      showCallPrompt() {
        const callPrompt = document.getElementById('sandra-call-prompt');
        if (callPrompt) {
          callPrompt.style.display = 'flex';
          // Scroll suave sin mover todo el chat hacia arriba
          setTimeout(() => {
            callPrompt.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });
          }, 100);
        }
      }

      startConversationalCall() {
        console.log('Iniciando llamada conversacional...');
        this.chatLocked = true; // bloquear chat al iniciar llamada
        // Reproducir ringtone (3 rings largos, se descuelga autom√°ticamente en el tercero)
        this.playRingtone();
        // El ringtone ahora maneja el descolgar autom√°ticamente despu√©s del tercer ring
      }

      endConversationalCall() {
        console.log('Finalizando llamada conversacional...');
        this.playHangupSound();
        this.stopRingtone();
        
        // Cerrar WebSocket si est√° activo
        if (this.activeCall) {
          // Limpiar timer de grabaci√≥n si existe
          if (this.activeCall.recordingTimer) {
            clearInterval(this.activeCall.recordingTimer);
          }
          // Detener MediaRecorder si existe
          if (this.activeCall.mediaRecorder && this.activeCall.mediaRecorder.state !== 'inactive') {
            this.activeCall.mediaRecorder.stop();
          }
          // Detener stream si existe - CR√çTICO: Detener tracks para cerrar micr√≥fono
          if (this.activeCall.stream) {
            this.activeCall.stream.getTracks().forEach(track => {
              track.stop(); // Detener completamente el track
            });
          }
          // Cerrar WebSocket
          if (this.activeCall.close) {
            this.activeCall.close();
          }
          this.activeCall = null;
        }
        
        // REHABILITAR CHAT DESPU√âS DE LLAMADA
        const chatInput = document.getElementById('sandra-input');
        const chatSendBtn = document.getElementById('sandra-send-btn');
        const chatMicBtn = document.getElementById('sandra-mic-btn');
        if (chatInput) {
          chatInput.disabled = false;
          chatInput.style.opacity = '1';
          chatInput.placeholder = 'Escribe tu mensaje...';
        }
        if (chatSendBtn) {
          chatSendBtn.disabled = false;
          chatSendBtn.style.opacity = '1';
        }
        if (chatMicBtn) {
          chatMicBtn.disabled = false;
          chatMicBtn.style.opacity = '1';
        }
        
        // Ocultar barrita de control
        const callControls = document.getElementById('sandra-call-controls');
        if (callControls) callControls.classList.add('hidden');
        
        // Detener y limpiar audio actual si existe
        if (this.currentAudio) {
          this.currentAudio.pause();
          // Revocar Blob URL si existe
          if (this.currentAudio._blobUrl) {
            URL.revokeObjectURL(this.currentAudio._blobUrl);
            this.currentAudio._blobUrl = null;
          }
          this.currentAudio = null;
        }
        
        // Resetear estados de pausa y mute
        this.isCallPaused = false;
        this.isMicrophoneMuted = false;
        
        // Volver hero a imagen est√°tica
        const heroImage = document.getElementById('hero-background-image');
        const heroVideo = document.getElementById('hero-video');
        if (heroImage && heroVideo) {
          heroVideo.style.transition = 'opacity 0.5s ease-out';
          heroVideo.style.opacity = '0';
          setTimeout(() => {
            heroVideo.style.display = 'none';
            heroImage.style.display = 'block';
            heroImage.style.opacity = '0';
            heroImage.style.transition = 'opacity 0.5s ease-in';
            setTimeout(() => {
              heroImage.style.opacity = '1';
            }, 100);
          }, 500);
        }
        
        this.addMessage('Llamada finalizada. ¬øEn qu√© m√°s puedo ayudarte?', 'bot');
        this.chatLocked = false; // desbloquear chat tras colgar
        // Reponer prompt de llamada/chat
        setTimeout(() => {
          this.showCallPrompt();
        }, 200);
      }

      toggleCallPause() {
        this.isCallPaused = !this.isCallPaused;
        const pauseBtn = document.getElementById('sandra-pause-btn');
        
        if (this.isCallPaused) {
          // Pausar: detener grabaci√≥n y audio
          if (this.activeCall && this.activeCall.mediaRecorder && this.activeCall.mediaRecorder.state === 'recording') {
            this.activeCall.mediaRecorder.stop();
          }
          if (this.currentAudio) {
            this.currentAudio.pause();
            // No revocar Blob URL aqu√≠, puede reanudarse
          }
          if (pauseBtn) {
            pauseBtn.classList.remove('bg-yellow-500');
            pauseBtn.classList.add('bg-green-500');
            pauseBtn.title = 'Reanudar llamada';
            pauseBtn.innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
          }
          this.addMessage('Llamada pausada', 'bot');
        } else {
          // Reanudar: reiniciar grabaci√≥n
          if (this.activeCall && this.activeCall.startNewRecording) {
            this.activeCall.startNewRecording();
          }
          if (pauseBtn) {
            pauseBtn.classList.remove('bg-green-500');
            pauseBtn.classList.add('bg-yellow-500');
            pauseBtn.title = 'Pausar llamada';
            pauseBtn.innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
          }
          this.addMessage('Llamada reanudada', 'bot');
        }
      }

      toggleMicrophoneMute() {
        this.isMicrophoneMuted = !this.isMicrophoneMuted;
        const muteBtn = document.getElementById('sandra-mute-btn');
        const muteIcon = document.getElementById('sandra-mute-icon');
        const unmuteIcon = document.getElementById('sandra-unmute-icon');
        
        if (this.activeCall && this.activeCall.stream) {
          this.activeCall.stream.getAudioTracks().forEach(track => {
            track.enabled = !this.isMicrophoneMuted;
          });
        }
        
        if (this.isMicrophoneMuted) {
          if (muteBtn) {
            muteBtn.classList.remove('bg-slate-400');
            muteBtn.classList.add('bg-red-500');
            muteBtn.title = 'Activar micr√≥fono';
          }
          if (muteIcon) muteIcon.classList.add('hidden');
          if (unmuteIcon) unmuteIcon.classList.remove('hidden');
          this.addMessage('Micr√≥fono silenciado', 'bot');
        } else {
          if (muteBtn) {
            muteBtn.classList.remove('bg-red-500');
            muteBtn.classList.add('bg-slate-400');
            muteBtn.title = 'Silenciar micr√≥fono';
          }
          if (muteIcon) muteIcon.classList.remove('hidden');
          if (unmuteIcon) unmuteIcon.classList.add('hidden');
          this.addMessage('Micr√≥fono activado', 'bot');
        }
      }

      playRingtone() {
        if (this.ringtoneInterval) return; // Ya est√° sonando
        
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let ringCount = 0;
        const MAX_RINGS = 2; // Solo 2 rings, luego se descuelga
        const RING_DURATION = 1.5; // Duraci√≥n de cada ring (1.5 segundos - balanceado)
        const PAUSE_BETWEEN_RINGS = 2000; // Pausa de 2 segundos entre rings
        
        const playSingleRing = () => {
          ringCount++;
          console.log(`üîî Reproduciendo ring ${ringCount} de ${MAX_RINGS}...`);
          
          const baseTime = audioContext.currentTime;
          
          // RINGTONE CALMADO Y PROFESIONAL: Tono balanceado y suave (1.5 segundos)
          // Frecuencias est√°ndar: 425Hz + 480Hz mezclados, volumen moderado y transiciones suaves
          
          // RING (1.5 segundos) - 425Hz + 480Hz simult√°neos, suave
          const osc1 = audioContext.createOscillator();
          const gain1 = audioContext.createGain();
          osc1.connect(gain1);
          gain1.connect(audioContext.destination);
          osc1.frequency.value = 425; // Frecuencia est√°ndar de tel√©fono
          osc1.type = 'sine';
          // Transiciones suaves y volumen moderado para sonido calmado
          gain1.gain.setValueAtTime(0, baseTime);
          gain1.gain.linearRampToValueAtTime(0.18, baseTime + 0.08); // Subida suave
          gain1.gain.setValueAtTime(0.18, baseTime + RING_DURATION - 0.1); // Mantener volumen constante
          gain1.gain.linearRampToValueAtTime(0, baseTime + RING_DURATION); // Bajada suave
          osc1.start(baseTime);
          osc1.stop(baseTime + RING_DURATION);
          
          const osc2 = audioContext.createOscillator();
          const gain2 = audioContext.createGain();
          osc2.connect(gain2);
          gain2.connect(audioContext.destination);
          osc2.frequency.value = 480; // Segunda frecuencia para sonido m√°s rico
          osc2.type = 'sine';
          // Volumen moderado para sonido calmado
          gain2.gain.setValueAtTime(0, baseTime);
          gain2.gain.linearRampToValueAtTime(0.15, baseTime + 0.08);
          gain2.gain.setValueAtTime(0.15, baseTime + RING_DURATION - 0.1);
          gain2.gain.linearRampToValueAtTime(0, baseTime + RING_DURATION);
          osc2.start(baseTime);
          osc2.stop(baseTime + RING_DURATION);
          
          console.log(`‚úÖ Ring ${ringCount} de ${MAX_RINGS} completado`);
          
          // Verificar si es el √∫ltimo ring DESPU√âS de reproducirlo
          if (ringCount >= MAX_RINGS) {
            // Despu√©s del segundo ring, detener y descolgar
            console.log('üîî Segundo ring completado, descolgando llamada...');
            // Esperar a que termine el ring antes de descolgar
            setTimeout(() => {
              this.stopRingtone();
              setTimeout(() => {
                console.log('üìû [PASO 1/4] Reproduciendo sonido de descolgar...');
                this.playPickupSound();
                setTimeout(() => {
                  console.log('üé• [PASO 2/4] Iniciando transici√≥n de video...');
                  this.transitionHeroToVideo();
                  setTimeout(() => {
                    console.log('üé¨ [PASO 3/4] Iniciando stream de video y llamada...');
                    this.startVideoStream();
                    console.log('‚úÖ [PASO 4/4] Flujo de descolgar completado');
                  }, 500);
                }, 300);
              }, 200); // Pausa antes del pickup
            }, RING_DURATION * 1000); // Esperar a que termine el ring actual
          }
        };
        
        // Reproducir primer ring inmediatamente
        console.log('üîî Iniciando ringtone...');
        playSingleRing();
        
        // Reproducir segundo ring despu√©s de RING_DURATION + PAUSE_BETWEEN_RINGS
        setTimeout(() => {
          if (ringCount < MAX_RINGS) {
            playSingleRing();
          }
        }, (RING_DURATION * 1000) + PAUSE_BETWEEN_RINGS);
      }

      stopRingtone() {
        if (this.ringtoneInterval) {
          clearInterval(this.ringtoneInterval);
          this.ringtoneInterval = null;
        }
      }

      playPickupSound() {
        console.log('üìû Reproduciendo sonido de descolgar...');
        // Sonido de descolgar llamada (call center) - "clic" claro y distintivo
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const currentTime = audioContext.currentTime;
        
        // Sonido de "clic" corto y claro (como un tel√©fono descolgando)
        // Tono agudo y corto para simular el "clic" mec√°nico
        const osc1 = audioContext.createOscillator();
        const gain1 = audioContext.createGain();
        osc1.connect(gain1);
        gain1.connect(audioContext.destination);
        osc1.frequency.value = 800; // Tono m√°s agudo para "clic"
        osc1.type = 'sine';
        gain1.gain.setValueAtTime(0, currentTime);
        gain1.gain.linearRampToValueAtTime(0.4, currentTime + 0.01); // Volumen m√°s alto para que se escuche
        gain1.gain.exponentialRampToValueAtTime(0.001, currentTime + 0.2); // Un poco m√°s largo
        osc1.start(currentTime);
        osc1.stop(currentTime + 0.2);
        
        // Segundo tono m√°s bajo para darle cuerpo al "clic"
        const osc2 = audioContext.createOscillator();
        const gain2 = audioContext.createGain();
        osc2.connect(gain2);
        gain2.connect(audioContext.destination);
        osc2.frequency.value = 400; // Tono m√°s bajo
        osc2.type = 'sine';
        gain2.gain.setValueAtTime(0, currentTime + 0.02);
        gain2.gain.linearRampToValueAtTime(0.3, currentTime + 0.03); // Volumen m√°s alto
        gain2.gain.exponentialRampToValueAtTime(0.001, currentTime + 0.25);
        osc2.start(currentTime + 0.02);
        osc2.stop(currentTime + 0.25);
        
        console.log('‚úÖ Sonido de descolgar reproducido');
      }

      playHangupSound() {
        // Sonido de colgar llamada (call center)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Tono de desconexi√≥n (beep descendente)
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.frequency.setValueAtTime(600, audioContext.currentTime);
        osc.frequency.exponentialRampToValueAtTime(300, audioContext.currentTime + 0.2);
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.15, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        osc.start(audioContext.currentTime);
        osc.stop(audioContext.currentTime + 0.2);
      }

      transitionHeroToVideo() {
        console.log('üé• Transici√≥n: Imagen est√°tica ‚Üí Video');
        const heroImage = document.getElementById('hero-background-image');
        const heroVideo = document.getElementById('hero-video');
        
        if (heroImage && heroVideo) {
          // Fade out imagen
          heroImage.style.transition = 'opacity 0.8s ease-out';
          heroImage.style.opacity = '0';
          
          // Fade in video despu√©s de un momento
          setTimeout(() => {
            heroImage.style.display = 'none';
            heroVideo.style.display = 'block';
            heroVideo.style.opacity = '0';
            heroVideo.style.transition = 'opacity 0.8s ease-in';
            setTimeout(() => {
              heroVideo.style.opacity = '1';
              console.log('‚úÖ Transici√≥n de video completada');
            }, 100);
          }, 800);
        } else {
          console.warn('‚ö†Ô∏è No se encontraron elementos hero-image o hero-video');
        }
      }

      startVideoStream() {
        console.log('üé¨ Iniciando stream de video...');
        const heroVideo = document.getElementById('hero-video');
        const videoSource = heroVideo.querySelector('source');
        
        // Mostrar barrita de control INMEDIATAMENTE (no esperar a WebSocket)
        const callControls = document.getElementById('sandra-call-controls');
        if (callControls) {
          callControls.classList.remove('hidden');
          console.log('‚úÖ Barrita de control mostrada');
        }
        
        // Mostrar mensaje de "Conectando..."
        // NO mostrar "Conectando..." durante llamada - el saludo vendr√° del servidor
        
        if (heroVideo && videoSource) {
          // Usar el primer video (puedes alternar entre los dos)
          videoSource.src = 'assets/videos/sandra-call-1.mp4';
          heroVideo.load();
          heroVideo.play().catch(e => console.log('Error al reproducir video:', e));
          
          // Cuando termine el primer video, reproducir el segundo en loop
          heroVideo.addEventListener('ended', () => {
            videoSource.src = 'assets/videos/sandra-call-2.mp4';
            heroVideo.load();
            heroVideo.loop = true;
            heroVideo.play().catch(e => console.log('Error al reproducir video:', e));
          }, { once: true });
          
          console.log('‚úÖ Video de llamada iniciado');
        }
        
        // Iniciar llamada conversacional en tiempo real
        console.log('üîå Iniciando conexi√≥n WebSocket...');
        this.startRealTimeCall();
      }

      startRealTimeCall() {
        console.log('üîå Iniciando conexi√≥n WebSocket a ws://localhost:4041...');
        console.log('üìã Estado actual del widget:', {
          isOpen: this.isOpen,
          activeCall: this.activeCall ? 'existe' : 'null'
        });
        
        // PREVENIR DOBLE CONEXI√ìN: Cerrar conexi√≥n anterior si existe
        if (this.activeCall) {
          console.log('‚ö†Ô∏è [CLIENTE] Cerrando conexi√≥n WebSocket anterior para evitar doble conexi√≥n...');
          try {
            if (this.activeCall.readyState === WebSocket.OPEN || this.activeCall.readyState === WebSocket.CONNECTING) {
              this.activeCall.close();
            }
            // Tambi√©n limpiar MediaRecorder y stream si existen
            if (this.activeCall.mediaRecorder && this.activeCall.mediaRecorder.state !== 'inactive') {
              this.activeCall.mediaRecorder.stop();
            }
            if (this.activeCall.stream) {
              this.activeCall.stream.getTracks().forEach(track => track.stop());
            }
          } catch (e) {
            console.error('Error cerrando conexi√≥n anterior:', e);
          }
          this.activeCall = null;
        }
        
        // Conectar WebSocket
        const ws = new WebSocket('ws://localhost:4041');
        console.log('üîå WebSocket creado, estado inicial:', ws.readyState); // 0 = CONNECTING
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let stream = null; // Guardar referencia del stream
        let recordingStartTime = null;
        const RECORDING_DURATION = 1200; // 1.2 segundos por grabaci√≥n (optimizado para menor latencia)
        this.isSpeaking = false; // Para barge-in (propiedad de instancia)
        this.audioQueue = []; // Cola de audio para barge-in (propiedad de instancia)
        
        // Timeout de conexi√≥n (5 segundos)
        let connectionTimeout = setTimeout(() => {
          if (ws.readyState === WebSocket.CONNECTING || ws.readyState === WebSocket.CLOSED) {
            console.error('‚è±Ô∏è Timeout: WebSocket no se conect√≥ en 5 segundos');
            ws.close();
            // Error cr√≠tico - permitir mostrar aunque haya llamada activa
            if (!this.activeCall) {
              this.addMessage('Error: No se pudo conectar al servidor. Verifica que el servidor WebSocket est√© corriendo en el puerto 4041.', 'bot');
            }
            const callControls = document.getElementById('sandra-call-controls');
            if (callControls) callControls.classList.add('hidden');
          }
        }, 5000);
        
        // Funci√≥n para enviar audio completo (WebM v√°lido)
        const sendCompleteAudio = () => {
          if (audioChunks.length === 0) {
            console.log('‚ö†Ô∏è No hay audio para enviar');
            return;
          }
          
          // Verificar que Sandra NO est√° hablando antes de procesar
          if (this.isSpeaking) {
            console.error('‚ùå [CLIENTE] ERROR: Intentando enviar audio mientras Sandra habla - DESCARTADO');
            audioChunks = [];
            return;
          }
          
          // Verificar si hay audio significativo (no silencio)
          const hasAudio = ws.hasSignificantAudio ? ws.hasSignificantAudio() : true;
          if (!hasAudio) {
            console.log('‚ö†Ô∏è [CLIENTE] Audio sin energ√≠a significativa (silencio) - DESCARTADO');
            audioChunks = [];
            if (ws.resetAudioEnergy) ws.resetAudioEnergy();
            return;
          }
          
          // Crear Blob completo con todos los chunks (esto forma un WebM v√°lido)
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm;codecs=opus' });
          
          // Verificar que el blob tenga contenido
          if (audioBlob.size === 0) {
            console.log('‚ö†Ô∏è Audio blob vac√≠o');
            audioChunks = []; // Limpiar
            return;
          }
          
          // Verificar tama√±o m√≠nimo (2000 bytes = ~200ms de audio) - reducido para menor latencia
          if (audioBlob.size < 2000) {
            console.log(`‚ö†Ô∏è Audio demasiado corto: ${audioBlob.size} bytes`);
            audioChunks = []; // Limpiar
            return;
          }
          
          console.log(`üì§ [CLIENTE] Enviando audio completo: ${audioBlob.size} bytes`);
          
          // Convertir a base64
          const reader = new FileReader();
          reader.onloadend = () => {
            let base64Audio = reader.result;
            
            // Remover prefijo "data:audio/webm;base64," si existe
            if (base64Audio.includes(',')) {
              base64Audio = base64Audio.split(',')[1];
            }
            
            if (!base64Audio || base64Audio.length === 0) {
              console.error('‚ùå Error: base64Audio vac√≠o despu√©s de procesar');
              audioChunks = []; // Limpiar
              return;
            }
            
            console.log(`üì§ [CLIENTE] Enviando audio a servidor: ${base64Audio.length} caracteres base64`);
            console.log(`üì§ [CLIENTE] Audio blob: ${audioBlob.size} bytes, tipo: ${audioBlob.type}`);
            
            ws.send(JSON.stringify({
              type: 'audio',
              audio: base64Audio
            }));
            
            console.log('‚úÖ [CLIENTE] Audio enviado correctamente al servidor');
            
            // Limpiar chunks despu√©s de enviar y resetear flag de audio
            audioChunks = [];
            if (ws.resetAudioEnergy) ws.resetAudioEnergy();
          };
          reader.onerror = () => {
            console.error('‚ùå Error leyendo audio blob');
            audioChunks = []; // Limpiar en caso de error
          };
          reader.readAsDataURL(audioBlob);
        };
        
        // Funci√≥n para iniciar nueva grabaci√≥n
        const startNewRecording = () => {
          // CR√çTICO: Solo grabar si Sandra NO est√° hablando
          if (this.isSpeaking) {
            console.log('‚ö†Ô∏è [CLIENTE] NO iniciar grabaci√≥n - Sandra est√° hablando');
            return;
          }
          
          if (!isRecording && mediaRecorder && mediaRecorder.state === 'inactive' && ws.readyState === WebSocket.OPEN && !this.isSpeaking) {
            audioChunks = []; // Limpiar chunks anteriores
            recordingStartTime = Date.now();
            mediaRecorder.start(); // Sin par√°metro = grabar hasta stop()
            isRecording = true;
            console.log('üéôÔ∏è [CLIENTE] Iniciando nueva grabaci√≥n de USUARIO (Sandra callada)');
          } else {
            console.log('‚ö†Ô∏è [CLIENTE] No se puede iniciar grabaci√≥n:', {
              isRecording,
              mediaRecorderState: mediaRecorder?.state,
              wsReadyState: ws.readyState,
              isSpeaking: this.isSpeaking
            });
          }
        };
        
        // Manejar errores de conexi√≥n
        ws.onerror = (error) => {
          console.error('‚ùå Error de conexi√≥n WebSocket:', error);
          clearTimeout(connectionTimeout);
          // Error cr√≠tico - permitir mostrar aunque haya llamada activa
          if (!this.activeCall) {
            this.addMessage('Error de conexi√≥n. Verifica que el servidor WebSocket est√© corriendo en el puerto 4041.', 'bot');
          }
          const callControls = document.getElementById('sandra-call-controls');
          if (callControls) callControls.classList.add('hidden');
        };
        
        ws.onclose = (event) => {
          console.log('üîå WebSocket cerrado:', event.code, event.reason);
          clearTimeout(connectionTimeout);
          if (event.code !== 1000) { // 1000 = cierre normal
            // Error cr√≠tico - permitir mostrar aunque haya llamada activa
            if (!this.activeCall) {
              this.addMessage('Conexi√≥n cerrada inesperadamente.', 'bot');
            }
            const callControls = document.getElementById('sandra-call-controls');
            if (callControls) callControls.classList.add('hidden');
          }
        };
        
        ws.onopen = () => {
          console.log('‚úÖ WebSocket conectado exitosamente');
          clearTimeout(connectionTimeout); // Limpiar timeout ya que se conect√≥
          
          // MEDIR LATENCIA: Marcar tiempo de descuelgue
          const pickupTime = Date.now();
          ws.pickupTime = pickupTime;
          console.log('‚è±Ô∏è [LATENCIA] Tiempo de descuelgue:', pickupTime);
          
          // Mostrar bot√≥n de colgar (ya deber√≠a estar visible desde startVideoStream)
          const callControls = document.getElementById('sandra-call-controls');
          if (callControls) callControls.classList.remove('hidden');
          
          // DESHABILITAR COMPLETAMENTE EL CHAT DURANTE LLAMADA
          const chatInput = document.getElementById('sandra-input');
          const chatSendBtn = document.getElementById('sandra-send-btn');
          const chatMicBtn = document.getElementById('sandra-mic-btn');
          const messagesContainer = document.getElementById('sandra-messages');
          
          if (chatInput) {
            chatInput.disabled = true;
            chatInput.style.opacity = '0.5';
            chatInput.placeholder = 'En llamada conversacional... Habla directamente';
          }
          if (chatSendBtn) {
            chatSendBtn.disabled = true;
            chatSendBtn.style.opacity = '0.5';
          }
          if (chatMicBtn) {
            chatMicBtn.disabled = true;
            chatMicBtn.style.opacity = '0.5';
          }
          
          // OCULTAR MENSAJES DEL CHAT DURANTE LLAMADA (no mostrar "Llamada conectada")
          // El saludo de voz se reproducir√° autom√°ticamente desde el servidor
          
          // Solicitar acceso al micr√≥fono PRIMERO
          console.log('üéôÔ∏è Solicitando acceso al micr√≥fono...');
          navigator.mediaDevices.getUserMedia({ audio: true })
            .then(userStream => {
              console.log('‚úÖ Acceso al micr√≥fono concedido');
              stream = userStream; // Guardar referencia
              // Configurar MediaRecorder para capturar audio
              mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'audio/webm;codecs=opus'
              });
              console.log('‚úÖ MediaRecorder configurado');
              
              // NOTIFICAR AL SERVIDOR QUE EL CLIENTE EST√Å COMPLETAMENTE LISTO (despu√©s de micr√≥fono)
              console.log('üì¢ Notificando al servidor que el cliente est√° completamente listo...');
              ws.send(JSON.stringify({
                type: 'ready',
                message: 'Cliente completamente listo para recibir saludo'
              }));
              
              mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                  audioChunks.push(event.data);
                  console.log(`üì¶ Chunk recibido: ${event.data.size} bytes (total: ${audioChunks.length} chunks)`);
                }
              };
              
              mediaRecorder.onstop = () => {
                console.log('‚èπÔ∏è [CLIENTE] MediaRecorder detenido, procesando audio...');
                isRecording = false;
                
                // Solo enviar audio si Sandra NO est√° hablando
                if (!this.isSpeaking) {
                  sendCompleteAudio();
                  
                  // Reiniciar grabaci√≥n SOLO si Sandra no est√° hablando (sin delay para menor latencia)
                  if (ws.readyState === WebSocket.OPEN && !this.isSpeaking) {
                    startNewRecording();
                  } else {
                    console.log('‚ö†Ô∏è [CLIENTE] No reiniciar grabaci√≥n - Sandra hablando o WebSocket cerrado');
                  }
                } else {
                  console.log('‚ö†Ô∏è [CLIENTE] NO enviar audio - Sandra est√° hablando (audio descartado)');
                  // Limpiar chunks si Sandra est√° hablando
                  audioChunks = [];
                }
              };
              
              // NO iniciar grabaci√≥n hasta que el saludo termine completamente
              // La grabaci√≥n se iniciar√° autom√°ticamente cuando el saludo termine (en audio.onended)
              console.log('üéôÔ∏è [CLIENTE] Preparado para grabar. Esperando saludo inicial...', {
                isSpeaking: this.isSpeaking,
                mediaRecorderState: mediaRecorder.state
              });
              console.log('‚è≥ [CLIENTE] La grabaci√≥n se iniciar√° autom√°ticamente cuando el saludo termine');
              
              // Timer para detener grabaci√≥n cada RECORDING_DURATION segundos
              // CR√çTICO: Solo detener si NO estamos en medio de una respuesta de Sandra
              const recordingTimer = setInterval(() => {
                if (isRecording && mediaRecorder && mediaRecorder.state === 'recording' && !this.isSpeaking) {
                  const elapsed = Date.now() - recordingStartTime;
                  if (elapsed >= RECORDING_DURATION) {
                    console.log(`‚è±Ô∏è [CLIENTE] Tiempo m√°ximo alcanzado (${elapsed}ms), deteniendo grabaci√≥n...`);
                    mediaRecorder.stop();
                  }
                } else if (isRecording && this.isSpeaking) {
                  // Si Sandra est√° hablando mientras grabamos, detener inmediatamente
                  console.log('üõë [CLIENTE] DETENIENDO grabaci√≥n - Sandra empez√≥ a hablar');
                  if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                  }
                }
              }, 500); // Verificar cada 500ms
              
              // Guardar referencias para limpiar al finalizar y acceso desde callbacks
              ws.recordingTimer = recordingTimer;
              ws.mediaRecorder = mediaRecorder;
              ws.stream = stream;
              ws.audioChunks = audioChunks; // Hacer accesible desde callbacks
              ws.isRecording = () => isRecording; // Getter para estado
              ws.setRecording = (val) => { isRecording = val; }; // Setter para estado
              ws.startNewRecording = startNewRecording; // Funci√≥n para reiniciar grabaci√≥n
              this.activeCall = ws; // Guardar referencia del WebSocket
              
              // Detectar cuando el usuario habla (barge-in) y medir energ√≠a de audio
              const audioContext = new (window.AudioContext || window.webkitAudioContext)();
              const analyser = audioContext.createAnalyser();
              const source = audioContext.createMediaStreamSource(stream);
              source.connect(analyser);
              analyser.fftSize = 256;
              analyser.smoothingTimeConstant = 0.8;
              
              // Variable para rastrear energ√≠a de audio
              let audioEnergy = 0;
              let hasSignificantAudio = false;
              
              const checkAudioLevel = () => {
                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(dataArray);
                const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                audioEnergy = average;
                
                // Si la energ√≠a es significativa (> 20), marcar que hay audio
                if (average > 20) {
                  hasSignificantAudio = true;
                }
                
                if (average > 30 && this.isSpeaking) {
                  // Usuario est√° hablando durante respuesta de IA -> Barge-in
                  console.log('üõë Barge-in detectado!');
                  this.audioQueue = []; // Limpiar cola de audio
                  this.isSpeaking = false;
                  // Detener cualquier audio que se est√© reproduciendo
                  if (this.currentAudio) {
                    this.currentAudio.pause();
                    // Revocar Blob URL en barge-in
                    if (this.currentAudio._blobUrl) {
                      URL.revokeObjectURL(this.currentAudio._blobUrl);
                      this.currentAudio._blobUrl = null;
                    }
                    this.currentAudio = null;
                  }
                }
                
                requestAnimationFrame(checkAudioLevel);
              };
              checkAudioLevel();
              
              // Guardar funci√≥n para verificar energ√≠a de audio
              ws.getAudioEnergy = () => audioEnergy;
              ws.hasSignificantAudio = () => hasSignificantAudio;
              ws.resetAudioEnergy = () => { hasSignificantAudio = false; };
            })
            .catch(err => {
              console.error('‚ùå Error accediendo al micr√≥fono:', err);
              this.addMessage('No se pudo acceder al micr√≥fono. Por favor, permite el acceso.', 'bot');
              const callControls = document.getElementById('sandra-call-controls');
              if (callControls) callControls.classList.add('hidden');
            });
        };
        
        ws.onmessage = (event) => {
          console.log('üì• Mensaje recibido del servidor:', event.data.substring(0, 100));
          const data = JSON.parse(event.data);
          
          if (data.type === 'timeout') {
            console.log('‚è±Ô∏è Llamada cerrada por inactividad');
            this.addMessage('La llamada se ha cerrado por inactividad. Si necesitas ayuda, puedes iniciar una nueva llamada.', 'bot');
            if (mediaRecorder && isRecording) {
              mediaRecorder.stop();
              isRecording = false;
            }
            if (stream) {
              stream.getTracks().forEach(track => track.stop());
            }
            ws.close();
            return;
          }
          
          if (data.type === 'text') {
            // Durante llamada conversacional, NO mostrar texto en el chat
            // Solo log para debugging
            console.log('üìù Respuesta de Sandra (no mostrada en chat durante llamada):', data.text);
          } else if (data.type === 'audio') {
            console.log('üîä [CLIENTE] Audio recibido de Sandra, tama√±o:', data.audio ? data.audio.length : 0, 'caracteres');
            console.log('üîç [DEBUG] isWelcome flag:', data.isWelcome);
            console.log('üîç [DEBUG] Tipo de mensaje:', data.type);
            console.log('üîç [DEBUG] Audio presente:', !!data.audio);
            
            // CR√çTICO: Detener grabaci√≥n INMEDIATAMENTE cuando Sandra empieza a hablar
            // Esto evita que el MediaRecorder capture el audio de Sandra por los altavoces
            if (ws.mediaRecorder) {
              if (ws.mediaRecorder.state === 'recording') {
                console.log('‚è∏Ô∏è [CLIENTE] DETENIENDO grabaci√≥n INMEDIATAMENTE - Sandra va a hablar');
                try {
                  ws.mediaRecorder.stop();
                  if (ws.setRecording) ws.setRecording(false);
                  isRecording = false;
                  // Limpiar chunks acumulados para evitar enviar audio mezclado
                  if (ws.audioChunks) {
                    ws.audioChunks.length = 0;
                    console.log('üßπ [CLIENTE] Chunks de audio limpiados');
                  }
                } catch (e) {
                  console.error('‚ùå [CLIENTE] Error deteniendo MediaRecorder:', e);
                }
              } else {
                console.log('‚ÑπÔ∏è [CLIENTE] MediaRecorder ya estaba detenido (estado:', ws.mediaRecorder.state, ')');
              }
            }
            
            // Reproducir audio de la IA
            if (!this.isSpeaking) {
              this.isSpeaking = true;
              console.log('‚ñ∂Ô∏è [CLIENTE] Reproduciendo audio de Sandra...');
              this.playAudioResponse(data.audio, data.isWelcome || false);
            } else {
              // Si ya est√° hablando, encolar
              console.log('üìã [CLIENTE] Audio encolado (Sandra ya est√° hablando)');
              this.audioQueue.push(data.audio);
            }
          } else if (data.type === 'noSpeech') {
            // No se entendi√≥ el audio - no es un error, solo informar al usuario
            if (!this.lastNoSpeechTime || (Date.now() - this.lastNoSpeechTime) > 3000) {
              this.addMessage(data.message || 'No he podido o√≠rte bien. ¬øPuedes repetirlo, por favor?', 'bot');
              this.lastNoSpeechTime = Date.now();
            }
            // La llamada sigue activa, no se cierra ni se muestra en chat
          } else if (data.type === 'error') {
            console.error('‚ùå Error del servidor:', data.message);
            this.addMessage('Error en la llamada: ' + data.message, 'bot');
            const callControls = document.getElementById('sandra-call-controls');
            if (callControls) callControls.classList.add('hidden');
          } else {
            console.log('‚ö†Ô∏è Tipo de mensaje desconocido:', data.type);
          }
        };
        
        // La referencia ya se guard√≥ arriba: this.activeCall = ws;
        console.log('‚úÖ WebSocket configurado completamente');
      }

      playAudioResponse(audioBase64, isWelcome = false) {
        // Si es el saludo inicial, NO detener audio anterior (no deber√≠a haber)
        if (!isWelcome && this.currentAudio) {
          this.currentAudio.pause();
          // Revocar Blob URL del audio anterior si existe
          if (this.currentAudio._blobUrl) {
            URL.revokeObjectURL(this.currentAudio._blobUrl);
          }
          this.currentAudio = null;
        }
        
        // SOLUCI√ìN OFICIAL: Convertir base64 a Blob y usar Blob URL en lugar de data URI
        // Esto asegura que el navegador trate el audio como archivo completo y lo bufferice correctamente
        const byteCharacters = atob(audioBase64);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const blob = new Blob([byteArray], { type: 'audio/mp3' });
        const blobUrl = URL.createObjectURL(blob);
        
        // Usar Blob URL en lugar de data URI
        const audio = new Audio(blobUrl);
        
        // Guardar flag isWelcome y blobUrl en el elemento audio para acceso en callbacks
        audio._isWelcome = isWelcome;
        audio._blobUrl = blobUrl; // Guardar para revocar despu√©s de la reproducci√≥n
        
        // FORZAR velocidad calmada (0.92x) para tono relajado pero natural
        audio.playbackRate = 0.92;
        audio.defaultPlaybackRate = 0.92;
        
        // Si es el saludo, esperar a que el audio est√© COMPLETAMENTE cargado antes de reproducir
        if (isWelcome) {
          console.log('üëã [CLIENTE] Cargando saludo inicial...');
          audio.preload = 'auto';

          // Prevenir reproducci√≥n duplicada
          let hasStartedPlaying = false;

          // ESTRATEGIA SIMPLIFICADA: Esperar canplaythrough + delay fijo
          const playWelcome = () => {
            if (hasStartedPlaying) return;
            hasStartedPlaying = true;

            console.log('‚úÖ [CLIENTE] Audio listo, esperando 1.5s para estabilizar buffer...');

            // MEDIR LATENCIA
            if (this.activeCall && this.activeCall.pickupTime) {
              const latency = Date.now() - this.activeCall.pickupTime;
              console.log(`‚è±Ô∏è [LATENCIA] Tiempo hasta buffer listo: ${latency}ms`);
            }

            // Delay fijo de 1.5 segundos para asegurar buffer completo
            setTimeout(() => {
              // Forzar posici√≥n al inicio UNA SOLA VEZ, justo antes de play
              audio.currentTime = 0;

              // Peque√±o delay adicional para que el seek se complete
              setTimeout(() => {
                console.log('‚ñ∂Ô∏è [CLIENTE] Reproduciendo saludo desde currentTime:', audio.currentTime);
                audio.play()
                  .then(() => console.log('‚úÖ [CLIENTE] Saludo iniciado'))
                  .catch(e => console.error('‚ùå Error:', e));
              }, 100);

            }, 1500);
          };

          // Esperar a que el audio est√© listo para reproducir sin interrupciones
          audio.addEventListener('canplaythrough', playWelcome, { once: true });

          // Timeout de seguridad (10 segundos)
          setTimeout(() => {
            if (!hasStartedPlaying) {
              console.warn('‚è∞ [CLIENTE] Timeout de seguridad, forzando reproducci√≥n');
              playWelcome();
            }
          }, 10000);

          // Forzar carga
          audio.load();
        }
        
        audio.onloadedmetadata = () => {
          console.log(`üìä [CLIENTE] Audio cargado: duraci√≥n ${audio.duration.toFixed(2)}s, velocidad actual ${audio.playbackRate}x`);
          // Verificar y forzar velocidad calmada despu√©s de cargar
          if (audio.playbackRate !== 0.92) {
            console.warn('‚ö†Ô∏è [CLIENTE] Velocidad incorrecta detectada, corrigiendo a 0.92x...');
            audio.playbackRate = 0.92;
          }
        };
        
        // Interceptar cualquier cambio de velocidad
        const originalSetPlaybackRate = Object.getOwnPropertyDescriptor(HTMLAudioElement.prototype, 'playbackRate')?.set;
        if (originalSetPlaybackRate) {
          Object.defineProperty(audio, 'playbackRate', {
            get: () => 0.92,
            set: (value) => {
              console.warn('‚ö†Ô∏è Intento de cambiar playbackRate a', value, '- ignorado, forzando 0.92');
            },
            configurable: true
          });
        }
        
        this.currentAudio = audio; // Guardar referencia para poder detenerlo
        
        // Si NO es el saludo, reproducir inmediatamente
        if (!isWelcome) {
          console.log('‚ñ∂Ô∏è [CLIENTE] Reproduciendo audio de Sandra (velocidad calmada: 0.92x, formato: MP3)...');
          audio.play().catch(e => console.error('Error reproduciendo audio:', e));
        }
        
        audio.onplay = () => {
          console.log(`‚ñ∂Ô∏è [CLIENTE] Audio iniciado, velocidad: ${audio.playbackRate}x`);
          // Verificar velocidad calmada al iniciar reproducci√≥n (solo una vez, sin intervalos)
          if (audio.playbackRate !== 0.92) {
            console.warn('‚ö†Ô∏è [CLIENTE] Velocidad incorrecta al iniciar, corrigiendo a 0.92x...');
            audio.playbackRate = 0.92;
          }
          // NO usar intervalos para forzar playbackRate - causa glitches de audio
        };
        
        audio.onended = () => {
          console.log('‚úÖ [CLIENTE] Audio de Sandra finalizado completamente');
          this.isSpeaking = false;
          
          // CR√çTICO: NO limpiar currentAudio inmediatamente (evitar cortes al final)
          // Aumentar delay para asegurar que el audio termine completamente
          setTimeout(() => {
            // Revocar Blob URL para liberar memoria
            if (audio._blobUrl) {
              URL.revokeObjectURL(audio._blobUrl);
              audio._blobUrl = null;
            }
            this.currentAudio = null;
          }, 800); // Aumentado a 800ms para evitar cortes al final
          
          // Si es el saludo, iniciar grabaci√≥n despu√©s de un delay
          if (audio._isWelcome) {
            console.log('üëã [CLIENTE] Saludo terminado, iniciando grabaci√≥n en 500ms...');
            setTimeout(() => {
              if (this.activeCall && this.activeCall.startNewRecording && !this.isSpeaking) {
                this.activeCall.startNewRecording();
              }
            }, 500); // 500ms de margen despu√©s del saludo
          } else {
            // CR√çTICO: Esperar tiempo m√≠nimo antes de reiniciar grabaci√≥n para evitar eco
            // Reiniciar grabaci√≥n SOLO despu√©s de que Sandra termine completamente de hablar
            if (this.activeCall && this.activeCall.mediaRecorder && this.activeCall.mediaRecorder.state === 'inactive' && this.activeCall.startNewRecording) {
              console.log('üéôÔ∏è [CLIENTE] Esperando 500ms antes de reiniciar grabaci√≥n (evitar eco)...');
              setTimeout(() => {
                if (this.activeCall && this.activeCall.mediaRecorder && this.activeCall.mediaRecorder.state === 'inactive' && !this.isSpeaking) {
                  console.log('üéôÔ∏è [CLIENTE] Reiniciando grabaci√≥n de USUARIO (Sandra callada)');
                  this.activeCall.startNewRecording();
                } else {
                  console.log('‚ö†Ô∏è [CLIENTE] No reiniciar grabaci√≥n:', {
                    hasActiveCall: !!this.activeCall,
                    mediaRecorderState: this.activeCall?.mediaRecorder?.state,
                    isSpeaking: this.isSpeaking
                  });
                }
              }, 300); // Delay optimizado para menor latencia
            }
          }
          
          // Reproducir siguiente audio en cola si existe
          if (this.audioQueue && this.audioQueue.length > 0) {
            const nextAudio = this.audioQueue.shift();
            console.log('üìã [CLIENTE] Reproduciendo siguiente audio en cola');
            this.playAudioResponse(nextAudio);
          }
        };
        
        audio.onerror = (e) => {
          console.error('‚ùå Error reproduciendo audio:', e, audio.error);
          this.isSpeaking = false;
          // Revocar Blob URL en caso de error
          if (audio._blobUrl) {
            URL.revokeObjectURL(audio._blobUrl);
            audio._blobUrl = null;
          }
          this.currentAudio = null;
        };
      }

      addMessage(text, type) {
        // BLOQUEAR TODOS LOS MENSAJES DE TEXTO DURANTE LLAMADA CONVERSACIONAL
        // Solo permitir mensajes si NO hay llamada activa o si es un mensaje cr√≠tico del sistema
        if ((this.activeCall || this.chatLocked) && type !== 'system') {
          console.log('‚ö†Ô∏è Mensaje bloqueado durante llamada conversacional:', text);
          return; // No mostrar ning√∫n mensaje durante la llamada
        }
        
        const messagesContainer = document.getElementById('sandra-messages');
        const isUser = type === 'user';

        const html = `
          <div class="flex gap-2 ${isUser ? 'flex-row-reverse' : ''}">
            ${!isUser ? '<div class="w-6 h-6 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 flex-shrink-0 flex items-center justify-center text-[10px] text-white font-bold">S</div>' : ''}
            <div class="${isUser ? 'bg-blue-600 text-white' : 'bg-white border border-slate-100 text-slate-700'} p-2.5 rounded-xl ${isUser ? 'rounded-tr-none' : 'rounded-tl-none'} shadow-sm text-xs max-w-[85%]">
              <p>${text}</p>
            </div>
          </div>
        `;

        messagesContainer.insertAdjacentHTML('beforeend', html);
        // Auto-scroll suave al final
        setTimeout(() => {
          messagesContainer.scrollTo({
            top: messagesContainer.scrollHeight,
            behavior: 'smooth'
          });
        }, 50);
      }

      showTyping(show) {
        const typing = document.getElementById('sandra-typing');
        if (show) typing.classList.remove('hidden');
        else typing.classList.add('hidden');
      }
    }

    // Initialize widget
    document.addEventListener('DOMContentLoaded', () => {
      new SandraWidget();
    });
  </script>
</body>
</html>


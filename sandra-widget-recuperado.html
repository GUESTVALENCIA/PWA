<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sandra IA - Widget Conversacional</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Estilos adicionales para animaciones */
    @keyframes pulse-slow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-slow {
      animation: pulse-slow 2s ease-in-out infinite;
    }
    
    /* Asegurar que el widget siempre sea visible */
    #sandra-widget-root {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      z-index: 99999 !important;
      position: fixed !important;
      pointer-events: auto !important;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <!-- Contenido de la pÃ¡gina de ejemplo -->
  <div class="container mx-auto p-8">
    <h1 class="text-4xl font-bold text-center mb-8">Bienvenido a Guest Valencia PWA</h1>
    <p class="text-center text-gray-600">El widget de Sandra estÃ¡ activo en la esquina inferior derecha â†’</p>
  </div>

  <!-- WIDGET DE SANDRA - Script completo -->
  <script>
    // ============================================
    // CLASE SANDRAGATEWAY
    // ============================================
    class SandraGateway {
      constructor() {
        // Dynamic base URL detection (local vs production)
        if (window.location.hostname === 'localhost' || window.location.port === '4040') {
          this.baseUrl = '/api';
          this.wsUrl = 'ws://localhost:4041';
        } else if (window.location.protocol === 'file:') {
          this.baseUrl = 'http://localhost:4040/api';
          this.wsUrl = 'ws://localhost:4041';
        } else {
          this.baseUrl = '/api';
          const hostname = window.location.hostname;
          this.wsUrl = hostname === 'localhost' || hostname === '127.0.0.1' 
            ? 'ws://localhost:4041' 
            : `wss://${hostname}/ws`;
        }
      }

      async sendMessage(message, role = 'hospitality') {
        try {
          const response = await fetch(`${this.baseUrl}/sandra/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, role })
          });

          if (!response.ok) throw new Error('Gateway Error');
          const data = await response.json();
          return data.reply;
        } catch (error) {
          console.error('ðŸ’¥ Conversation Error:', error);
          throw error;
        }
      }
    }

    // ============================================
    // CLASE SANDRAWIDGET
    // ============================================
    class SandraWidget {
      constructor() {
        this.gateway = new SandraGateway();
        this.isOpen = false;
        this.isRecording = false;
        this.isCallPaused = false;
        this.isMicrophoneMuted = false;
        this.isSpeaking = false;
        this.audioQueue = [];
        this.currentAudio = null;
        this.activeCall = null;
        this.chatLocked = false;
        this.ringtoneInterval = null;
        this.lastNoSpeechTime = null;
        
        this.init();
      }

      init() {
        this.createWidgetUI();
        this.ensureVisibility();
        this.bindEvents();
        console.log('âœ… SandraWidget inicializado correctamente');
      }

